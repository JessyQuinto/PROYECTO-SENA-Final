import{j as e}from"./radix-pxeQr2vL.js";import{k as C,i as S,b as c}from"./react-9ItUixmA.js";import{d as P,s as o,I as t,C as m,b as g,B as _}from"./index-DDd0kLwX.js";import{I}from"./input-s_SeVYy5.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const F=()=>{const{id:r}=C(),x=S(),{add:p}=P(),[a,u]=c.useState(null),[l,y]=c.useState(null),[h,j]=c.useState(!0),[n,b]=c.useState(1),[s,N]=c.useState(null);if(c.useEffect(()=>{(async()=>{const[{data:i},{data:d},v]=await Promise.all([o.from("productos").select("id,nombre,descripcion,precio,stock,imagen_url,estado,categorias(nombre)").eq("id",r).maybeSingle(),o.from("mv_promedio_calificaciones").select("promedio").eq("producto_id",r).maybeSingle(),(async()=>{try{const w=`product_story:${r}`,{data:k}=await o.from("app_config").select("value").eq("key",w).maybeSingle();return k?.value||null}catch{return null}})()]);u(i),y(typeof d?.promedio=="number"?Number(d.promedio):null),N(v),j(!1)})()},[r]),h)return e.jsx("div",{className:"container py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(t,{category:"Estados y Feedback",name:"HugeiconsReload",className:"w-8 h-8 animate-spin"})})});if(!a)return e.jsx("div",{className:"container py-8",children:"Producto no encontrado"});const f=()=>{p({productoId:a.id,nombre:a.nombre,precio:a.precio,cantidad:n,imagenUrl:a.imagen_url,stock:a.stock}),x("/carrito")};return e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx(m,{className:"overflow-hidden",children:e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"relative bg-gray-100",style:{paddingTop:"66%"},children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"absolute inset-0 w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(t,{category:"Catálogo y producto",name:"MynauiImage",className:"w-16 h-16"})})})})}),e.jsx(m,{children:e.jsxs(g,{className:"p-6 space-y-4",children:[e.jsxs("h1",{className:"heading-lg flex items-center gap-3",children:[e.jsx(t,{category:"Catálogo y producto",name:"BxsPackage",className:"w-8 h-8"}),a.nombre]}),l!==null&&e.jsxs("div",{className:"text-sm text-yellow-600 flex items-center gap-1",children:[e.jsx(t,{category:"Catálogo y producto",name:"LucideHeart",className:"w-4 h-4"}),l.toFixed(1)]}),a.descripcion&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Descripción"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:a.descripcion})]}),e.jsxs("div",{className:"text-3xl font-bold text-(--color-terracotta-suave) flex items-center gap-2",children:[e.jsx(t,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-6 h-6"}),"$",a.precio?.toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"form-label flex items-center gap-2",children:[e.jsx(t,{category:"Catálogo y producto",name:"BxsPackage",className:"w-4 h-4"}),"Cantidad"]}),e.jsx(I,{type:"number",min:1,max:a.stock,value:n,onChange:i=>b(Math.max(1,Math.min(Number(i.target.value||1),a.stock))),className:"w-24"}),e.jsxs(_,{onClick:f,className:"flex items-center gap-2",children:[e.jsx(t,{category:"Carrito y checkout",name:"WhhShoppingcart",className:"w-4 h-4"}),"Añadir al carrito"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(t,{category:"Vendedor",name:"SiInventoryFill",className:"w-4 h-4"}),"Stock disponible: ",a.stock]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-gray-500",children:"Historia y origen"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s?.historia?.trim()||`Producido y fabricado a mano por campesinos de la región. ${a.categorias?.nombre?`${a.categorias.nombre} elaborada con dedicación, respetando técnicas locales y cuidando cada detalle.`:"Pieza elaborada con dedicación, respetando técnicas locales y cuidando cada detalle."}`}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[s?.materiales&&e.jsx("span",{className:"badge badge-secondary",title:"Materiales",children:s.materiales}),s?.tecnica&&e.jsx("span",{className:"badge badge-secondary",title:"Técnica",children:s.tecnica}),s?.origen&&e.jsx("span",{className:"badge badge-secondary",title:"Origen",children:s.origen}),s?.cuidados&&e.jsx("span",{className:"badge badge-secondary",title:"Cuidados",children:s.cuidados})]})]})]})})]})})};export{F as default};
