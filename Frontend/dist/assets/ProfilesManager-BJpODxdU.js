import{j as e}from"./radix-pxeQr2vL.js";import{b as p}from"./react-9ItUixmA.js";import{I as d,C as S,b as q,B as l,s as i}from"./index-DDd0kLwX.js";import{I as m}from"./input-s_SeVYy5.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const J=()=>{const[P,M]=p.useState([]),[T,A]=p.useState([]),[t,o]=p.useState({tipo:"envio",nombre:"",telefono:"",direccion:"",direccion2:"",ciudad:"",departamento:"",codigo_postal:""}),[r,u]=p.useState({metodo:"contraentrega",etiqueta:"Contraentrega"}),[w,j]=p.useState(!1),[y,N]=p.useState(1),[_,F]=p.useState(0),[v,C]=p.useState(1),[b,D]=p.useState(0),h=5,g=async()=>{if(!i)return;const s=(await i.auth.getSession()).data.session?.user?.id;if(!s)return;const n=(y-1)*h,x=n+h-1,c=(v-1)*h,f=c+h-1,[E,k]=await Promise.all([i.from("user_address").select("*",{count:"exact"}).eq("user_id",s).order("es_predeterminada",{ascending:!1}).order("created_at",{ascending:!1}).range(n,x),i.from("user_payment_profile").select("*",{count:"exact"}).eq("user_id",s).order("es_predeterminada",{ascending:!1}).order("created_at",{ascending:!1}).range(c,f)]);M(E.data||[]),F(E.count||0),A(k.data||[]),D(k.count||0)};p.useEffect(()=>{g()},[]);const I=async()=>{if(i){j(!0);try{const s=(await i.auth.getSession()).data.session?.user?.id;if(!s)throw new Error("Sesión no disponible");const n={...t,user_id:s,es_predeterminada:!!t.es_predeterminada};let x=t.id;if(t.id){const{error:c}=await i.from("user_address").update(n).eq("id",t.id).eq("user_id",s);if(c)throw c}else{const{data:c,error:f}=await i.from("user_address").insert(n).select().limit(1).single();if(f)throw f;x=c?.id}n.es_predeterminada&&await i.from("user_address").update({es_predeterminada:!1}).eq("user_id",s).eq("tipo",n.tipo).neq("id",x||"00000000-0000-0000-0000-000000000000"),window.toast?.success("Dirección guardada"),o({tipo:"envio",nombre:"",telefono:"",direccion:"",direccion2:"",ciudad:"",departamento:"",codigo_postal:""}),await g()}catch(a){window.toast?.error(a?.message||"Error guardando dirección")}finally{j(!1)}}},V=a=>o({...a}),z=async a=>{if(!i||!confirm("¿Eliminar dirección?"))return;const{error:s}=await i.from("user_address").delete().eq("id",a);if(s){window.toast?.error(s.message);return}window.toast?.success("Dirección eliminada"),await g()},L=async()=>{if(i){j(!0);try{const s=(await i.auth.getSession()).data.session?.user?.id;if(!s)throw new Error("Sesión no disponible");const n={...r,user_id:s,es_predeterminada:!!r.es_predeterminada};let x=r.id;if(r.id){const{error:c}=await i.from("user_payment_profile").update(n).eq("id",r.id).eq("user_id",s);if(c)throw c}else{const{data:c,error:f}=await i.from("user_payment_profile").insert(n).select().limit(1).single();if(f)throw f;x=c?.id}n.es_predeterminada&&await i.from("user_payment_profile").update({es_predeterminada:!1}).eq("user_id",s).neq("id",x||"00000000-0000-0000-0000-000000000000"),window.toast?.success("Método de pago guardado"),u({metodo:"contraentrega",etiqueta:"Contraentrega"}),await g()}catch(a){window.toast?.error(a?.message||"Error guardando método de pago")}finally{j(!1)}}},W=a=>u({...a}),B=async a=>{if(!i||!confirm("¿Eliminar método de pago?"))return;const{error:s}=await i.from("user_payment_profile").delete().eq("id",a);if(s){window.toast?.error(s.message);return}window.toast?.success("Método de pago eliminado"),await g()};return e.jsxs("div",{className:"container py-8",children:[e.jsxs("h1",{className:"heading-lg mb-6 flex items-center gap-3",children:[e.jsx(d,{category:"Usuario",name:"RivetIconsSettings",className:"w-8 h-8"}),"Perfiles guardados"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(S,{children:e.jsxs(q,{className:"p-6 space-y-4",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2",children:[e.jsx(d,{category:"Carrito y checkout",name:"HugeiconsMapsLocation01",className:"w-5 h-5"}),"Direcciones"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("select",{className:"input",value:t.tipo,onChange:a=>o({...t,tipo:a.target.value}),children:[e.jsx("option",{value:"envio",children:"Envío"}),e.jsx("option",{value:"facturacion",children:"Facturación"})]}),e.jsx(m,{placeholder:"Nombre",value:t.nombre,onChange:a=>o({...t,nombre:a.target.value})}),e.jsx(m,{placeholder:"Teléfono",value:t.telefono,onChange:a=>o({...t,telefono:a.target.value})}),e.jsx(m,{className:"md:col-span-2",placeholder:"Dirección",value:t.direccion,onChange:a=>o({...t,direccion:a.target.value})}),e.jsx(m,{className:"md:col-span-2",placeholder:"Apto, interior, referencia",value:t.direccion2,onChange:a=>o({...t,direccion2:a.target.value})}),e.jsx(m,{placeholder:"Ciudad",value:t.ciudad,onChange:a=>o({...t,ciudad:a.target.value})}),e.jsx(m,{placeholder:"Departamento",value:t.departamento,onChange:a=>o({...t,departamento:a.target.value})}),e.jsx(m,{placeholder:"Código postal",value:t.codigo_postal,onChange:a=>o({...t,codigo_postal:a.target.value})}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.es_predeterminada,onChange:a=>{const s=a.target.checked;s&&t.es_predeterminada!==!0&&!confirm("Marcar como predeterminada reemplazará la actual predeterminada. ¿Continuar?")||o({...t,es_predeterminada:s})}}),"Predeterminada"]}),e.jsxs("div",{className:"md:col-span-2 flex gap-2",children:[e.jsxs(l,{disabled:w,onClick:I,className:"flex items-center gap-2",children:[e.jsx(d,{category:"Vendedor",name:"FaSolidEdit",className:"w-4 h-4"}),t.id?"Actualizar":"Guardar"]}),t.id&&e.jsxs(l,{variant:"secondary",onClick:()=>o({tipo:"envio",nombre:"",telefono:"",direccion:"",direccion2:"",ciudad:"",departamento:"",codigo_postal:""}),className:"flex items-center gap-2",children:[e.jsx(d,{category:"Estados y Feedback",name:"BxErrorCircle",className:"w-4 h-4"}),"Cancelar"]})]})]}),e.jsx("ul",{className:"text-sm divide-y",children:P.map(a=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"truncate pr-3",children:[e.jsxs("span",{className:"font-medium",children:["[",a.tipo,"]"]})," ",a.nombre," — ",a.ciudad,", ",a.departamento," ",a.es_predeterminada?e.jsx("span",{className:"badge badge-success ml-2",children:"Default"}):null]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"secondary",onClick:()=>V(a),className:"flex items-center gap-1",children:[e.jsx(d,{category:"Vendedor",name:"FaSolidEdit",className:"w-3 h-3"}),"Editar"]}),e.jsxs(l,{variant:"destructive",onClick:()=>z(a.id),className:"flex items-center gap-1",children:[e.jsx(d,{category:"Vendedor",name:"LineMdTrash",className:"w-3 h-3"}),"Eliminar"]})]})]},a.id))}),e.jsxs("div",{className:"flex items-center justify-between text-sm pt-2",children:[e.jsxs("span",{children:["Página ",y," de ",Math.max(1,Math.ceil(_/h))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"secondary",disabled:y<=1,onClick:()=>{N(a=>a-1),setTimeout(g,0)},className:"flex items-center gap-1",children:[e.jsx(d,{category:"Catálogo y producto",name:"WhhArrowdown",className:"w-3 h-3"}),"Anterior"]}),e.jsxs(l,{variant:"secondary",disabled:y>=Math.ceil(_/h),onClick:()=>{N(a=>a+1),setTimeout(g,0)},className:"flex items-center gap-1",children:[e.jsx(d,{category:"Catálogo y producto",name:"WhhArrowup",className:"w-3 h-3"}),"Siguiente"]})]})]})]})}),e.jsx(S,{children:e.jsxs(q,{className:"p-6 space-y-4",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2",children:[e.jsx(d,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-5 h-5"}),"Métodos de pago"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("select",{className:"input",value:r.metodo,onChange:a=>{const s=a.target.value;u(n=>({...n,metodo:s,etiqueta:s==="tarjeta"?n.last4?`Tarjeta •••• ${n.last4}`:"Tarjeta":"Contraentrega"}))},children:[e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"contraentrega",children:"Contraentrega"})]}),e.jsx(m,{placeholder:"Etiqueta",value:r.etiqueta||"",onChange:a=>u({...r,etiqueta:a.target.value})}),r.metodo==="tarjeta"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{placeholder:"Titular",value:r.titular||"",onChange:a=>u({...r,titular:a.target.value})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(m,{placeholder:"Last4",value:r.last4||"",onChange:a=>u({...r,last4:a.target.value})}),e.jsx(m,{placeholder:"MM",value:r.exp_mm||"",onChange:a=>u({...r,exp_mm:Number(a.target.value)})}),e.jsx(m,{placeholder:"YY",value:r.exp_yy||"",onChange:a=>u({...r,exp_yy:Number(a.target.value)})})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!r.es_predeterminada,onChange:a=>{const s=a.target.checked;s&&r.es_predeterminada!==!0&&!confirm("Marcar como predeterminado reemplazará el actual predeterminado. ¿Continuar?")||u({...r,es_predeterminada:s})}}),"Predeterminada"]}),e.jsxs("div",{className:"md:col-span-2 flex gap-2",children:[e.jsxs(l,{disabled:w,onClick:L,className:"flex items-center gap-2",children:[e.jsx(d,{category:"Vendedor",name:"FaSolidEdit",className:"w-4 h-4"}),r.id?"Actualizar":"Guardar"]}),r.id&&e.jsxs(l,{variant:"secondary",onClick:()=>u({metodo:"contraentrega",etiqueta:"Contraentrega"}),className:"flex items-center gap-2",children:[e.jsx(d,{category:"Estados y Feedback",name:"BxErrorCircle",className:"w-4 h-4"}),"Cancelar"]})]})]}),e.jsx("ul",{className:"text-sm divide-y",children:T.map(a=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"truncate pr-3",children:[e.jsxs("span",{className:"font-medium",children:["[",a.metodo,"]"]})," ",a.etiqueta," ",a.es_predeterminada?e.jsx("span",{className:"badge badge-success ml-2",children:"Default"}):null]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"secondary",onClick:()=>W(a),className:"flex items-center gap-1",children:[e.jsx(d,{category:"Vendedor",name:"FaSolidEdit",className:"w-3 h-3"}),"Editar"]}),e.jsxs(l,{variant:"destructive",onClick:()=>B(a.id),className:"flex items-center gap-1",children:[e.jsx(d,{category:"Vendedor",name:"LineMdTrash",className:"w-3 h-3"}),"Eliminar"]})]})]},a.id))}),e.jsxs("div",{className:"flex items-center justify-between text-sm pt-2",children:[e.jsxs("span",{children:["Página ",v," de ",Math.max(1,Math.ceil(b/h))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"secondary",disabled:v<=1,onClick:()=>{C(a=>a-1),setTimeout(g,0)},className:"flex items-center gap-1",children:[e.jsx(d,{category:"Catálogo y producto",name:"WhhArrowdown",className:"w-3 h-3"}),"Anterior"]}),e.jsxs(l,{variant:"secondary",disabled:v>=Math.ceil(b/h),onClick:()=>{C(a=>a+1),setTimeout(g,0)},className:"flex items-center gap-1",children:[e.jsx(d,{category:"Catálogo y producto",name:"WhhArrowup",className:"w-3 h-3"}),"Siguiente"]})]})]})]})})]})]})};export{J as default};
