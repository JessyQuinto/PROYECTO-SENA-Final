import{j as s}from"./radix-pxeQr2vL.js";import{b as t}from"./react-9ItUixmA.js";import{s as l}from"./index-DDd0kLwX.js";import{A as C}from"./AdminLayout-C4V03p12.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const S=i=>i.toString().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),F=()=>{const[i,d]=t.useState([]),[b,m]=t.useState(!0),[o,f]=t.useState(""),[r,n]=t.useState({nombre:"",slug:"",descripcion:""}),[u,g]=t.useState(!1),x=t.useMemo(()=>{const e=o.trim().toLowerCase();return e?i.filter(a=>a.nombre.toLowerCase().includes(e)||(a.slug||"").toLowerCase().includes(e)):i},[i,o]),p=async()=>{m(!0);const{data:e,error:a}=await l.from("categorias").select("*").order("created_at",{ascending:!1});a?console.error("Error loading categorias",a.message):d(e),m(!1)};t.useEffect(()=>{p()},[]);const j=e=>{const a=r.id?r.slug:S(e);n(c=>({...c,nombre:e,slug:a}))},h=()=>n({nombre:"",slug:"",descripcion:""}),N=async()=>{if(!r.nombre.trim()){alert("Nombre requerido");return}g(!0);try{if(r.id){const{error:e}=await l.from("categorias").update({nombre:r.nombre.trim(),slug:r.slug.trim(),descripcion:r.descripcion.trim()||null}).eq("id",r.id);if(e)throw e}else{const e={nombre:r.nombre.trim(),slug:r.slug.trim(),descripcion:r.descripcion.trim()||null},{error:a}=await l.from("categorias").insert(e);if(a)throw a}await p(),h()}catch(e){window.toast?.error(e?.message||"Error guardando categoría",{role:"admin",action:"update"})}finally{g(!1)}},v=e=>{n({id:e.id,nombre:e.nombre,slug:e.slug||"",descripcion:e.descripcion||""})},y=async e=>{if(!confirm("¿Eliminar categoría?"))return;const{error:a}=await l.from("categorias").delete().eq("id",e);a?window.toast?.error(a.message,{role:"admin",action:"delete"}):(d(c=>c.filter(w=>w.id!==e)),window.toast?.success("Categoría eliminada",{role:"admin",action:"delete"}))};return s.jsxs(C,{title:"Categorías",subtitle:"Crea, edita y elimina categorías del catálogo",children:[s.jsx("div",{className:"mb-6 flex items-center justify-between",children:s.jsx("input",{className:"input-hero max-w-md",placeholder:"Buscar categoría por nombre o slug...",value:o,onChange:e=>f(e.target.value)})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"card card-hover lg:col-span-1",children:[s.jsx("div",{className:"card-header",children:s.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[r.id?"Editar":"Nueva"," categoría"]})}),s.jsxs("div",{className:"card-body space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Nombre"}),s.jsx("input",{className:"input",value:r.nombre,onChange:e=>j(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Slug"}),s.jsx("input",{className:"input",value:r.slug,onChange:e=>n(a=>({...a,slug:e.target.value}))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Descripción"}),s.jsx("textarea",{className:"textarea",value:r.descripcion,onChange:e=>n(a=>({...a,descripcion:e.target.value}))})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{className:"btn btn-primary",onClick:N,disabled:u,children:u?"Guardando...":"Guardar"}),r.id&&s.jsx("button",{className:"btn btn-outline",onClick:h,children:"Cancelar"})]})]})]}),s.jsxs("div",{className:"card card-hover lg:col-span-2",children:[s.jsx("div",{className:"card-header",children:s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Listado"})}),s.jsx("div",{className:"card-body",children:b?s.jsx("p",{children:"Cargando..."}):x.length===0?s.jsx("p",{className:"text-gray-500",children:"Sin resultados"}):s.jsx("div",{className:"divide-y",children:x.map(e=>s.jsxs("div",{className:"py-3 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-gray-500",children:["/",e.slug]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>v(e),children:"Editar"}),s.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>y(e.id),children:"Eliminar"})]})]},e.id))})})]})]})]})};export{F as default};
