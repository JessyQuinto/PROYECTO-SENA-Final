import{j as e}from"./radix-pxeQr2vL.js";import{b as a}from"./react-9ItUixmA.js";import{s as p}from"./index-DDd0kLwX.js";import{A as P}from"./AdminLayout-C4V03p12.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const R=()=>{const[i,v]=a.useState(null),[x,h]=a.useState([]),[f,u]=a.useState(!0),[d,y]=a.useState(()=>{const s=new Date;return s.setDate(1),s.setHours(0,0,0,0),s.toISOString().slice(0,10)}),[n,S]=a.useState(()=>new Date().toISOString().slice(0,10)),[c,o]=a.useState(1),g=10,j=a.useCallback(async()=>{u(!0);const s=new Date(d),r=new Date(n);r.setDate(r.getDate()+1);const _=(c-1)*g,[{data:w,error:N},{data:k,error:b}]=await Promise.all([p.rpc("kpi_periodo",{inicio:s.toISOString(),fin:r.toISOString()}),p.rpc("top_productos_periodo",{inicio:s.toISOString(),fin:r.toISOString(),limite:g,desplazamiento:_})]);(N||b)&&console.error(N?.message||b?.message);const l=w?.[0]||{total_ventas:0,pedidos:0,ticket_promedio:0};v({totalVentasMes:Number(l.total_ventas||0),pedidosMes:Number(l.pedidos||0),ticketPromedio:Number(l.ticket_promedio||0)});const m=k||[];if(m.length>0){const M=m.map(t=>t.producto_id),{data:I}=await p.from("productos").select("id,nombre").in("id",M),D=new Map((I||[]).map(t=>[t.id,t.nombre]));h(m.map(t=>({id:t.producto_id,nombre:D.get(t.producto_id)||t.producto_id,total_vendido:Number(t.total_vendido||0)})))}else h([]);u(!1)},[d,n,c]);return a.useEffect(()=>{j()},[j]),e.jsx(P,{title:"Métricas",subtitle:"Indicadores clave y productos top del mes",children:f||!i?e.jsx("p",{children:"Cargando..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card card-hover",children:e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Ventas del Mes"}),e.jsxs("p",{className:"heading-lg",children:["$",i.totalVentasMes.toFixed(0)]})]})}),e.jsx("div",{className:"card card-hover",children:e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pedidos del Mes"}),e.jsx("p",{className:"heading-lg",children:i.pedidosMes})]})}),e.jsx("div",{className:"card card-hover",children:e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Ticket Promedio"}),e.jsxs("p",{className:"heading-lg",children:["$",i.ticketPromedio.toFixed(0)]})]})})]}),e.jsxs("div",{className:"card card-hover",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top 10 productos por ventas"})}),e.jsxs("div",{className:"card-body",children:[x.length===0?e.jsx("p",{className:"text-gray-500",children:"No hay datos este mes"}):e.jsx("ul",{className:"divide-y",children:x.map(s=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsx("span",{children:s.nombre}),e.jsxs("span",{className:"font-semibold",children:["$",s.total_vendido.toFixed(0)]})]},s.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Desde"}),e.jsx("input",{type:"date",className:"form-input w-40",value:d,onChange:s=>{y(s.target.value),o(1)}}),e.jsx("label",{className:"text-sm text-gray-600",children:"Hasta"}),e.jsx("input",{type:"date",className:"form-input w-40",value:n,onChange:s=>{S(s.target.value),o(1)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>o(s=>Math.max(1,s-1)),children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Página ",c]}),e.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>o(s=>s+1),children:"Siguiente"})]})]})]})]})]})})};export{R as default};
