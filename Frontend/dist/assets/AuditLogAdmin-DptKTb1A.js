import{j as e}from"./radix-pxeQr2vL.js";import{b as t}from"./react-9ItUixmA.js";import{s as f}from"./index-DDd0kLwX.js";import{A as v}from"./AdminLayout-C4V03p12.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const o=20,E=()=>{const[d,u]=t.useState([]),[x,m]=t.useState(!0),[r,l]=t.useState(1),[c,p]=t.useState(""),[i,h]=t.useState("all"),n=t.useMemo(()=>{const s=c.trim().toLowerCase();return d.filter(a=>{const g=i==="all"||a.entity.toLowerCase()===i.toLowerCase(),N=!s||a.action.toLowerCase().includes(s)||(a.entity_id||"").toLowerCase().includes(s);return g&&N})},[d,c,i]),j=t.useMemo(()=>{const s=(r-1)*o;return n.slice(s,s+o)},[n,r]),y=async()=>{m(!0);const{data:s,error:a}=await f.from("audit_log").select("id,actor_id,action,entity,entity_id,created_at,old_values,new_values").order("created_at",{ascending:!1}).limit(500);a&&console.error(a.message),u(s||[]),m(!1)};return t.useEffect(()=>{y()},[]),e.jsxs(v,{title:"Auditoría",subtitle:"Registro de acciones críticas",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{className:"input-hero max-w-md",placeholder:"Buscar por acción o entidad_id...",value:c,onChange:s=>p(s.target.value)}),e.jsxs("select",{className:"form-select w-48",value:i,onChange:s=>{l(1),h(s.target.value)},children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"users",children:"users"}),e.jsx("option",{value:"productos",children:"productos"}),e.jsx("option",{value:"orders",children:"orders"}),e.jsx("option",{value:"order_items",children:"order_items"})]})]}),e.jsxs("div",{className:"card card-hover",children:[e.jsx("div",{className:"card-body overflow-x-auto",children:x?e.jsx("p",{children:"Cargando..."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2 pr-4",children:"Fecha"}),e.jsx("th",{className:"py-2 pr-4",children:"Acción"}),e.jsx("th",{className:"py-2 pr-4",children:"Entidad"}),e.jsx("th",{className:"py-2 pr-4",children:"Entidad ID"}),e.jsx("th",{className:"py-2 pr-4",children:"Actor"}),e.jsx("th",{className:"py-2",children:"Diff"})]})}),e.jsx("tbody",{children:j.map(s=>e.jsxs("tr",{className:"border-t align-top",children:[e.jsx("td",{className:"py-2 pr-4 whitespace-nowrap",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"py-2 pr-4",children:s.action}),e.jsx("td",{className:"py-2 pr-4",children:s.entity}),e.jsx("td",{className:"py-2 pr-4 font-mono text-xs break-all",children:s.entity_id}),e.jsx("td",{className:"py-2 pr-4 text-xs",children:s.actor_id||"-"}),e.jsx("td",{className:"py-2",children:e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-(--color-marron-cacao)",children:"Ver cambios"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2",children:[e.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs overflow-auto",children:JSON.stringify(s.old_values,null,2)}),e.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs overflow-auto",children:JSON.stringify(s.new_values,null,2)})]})]})})]},s.id))})]})}),e.jsxs("div",{className:"card-footer flex items-center justify-between",children:[e.jsx("button",{className:"btn btn-outline",disabled:r===1,onClick:()=>l(s=>s-1),children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Página ",r]}),e.jsx("button",{className:"btn btn-outline",disabled:r*o>=n.length,onClick:()=>l(s=>s+1),children:"Siguiente"})]})]})]})};export{E as default};
