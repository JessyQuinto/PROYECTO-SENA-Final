import{j as e}from"./radix-pxeQr2vL.js";import{b as r,c as H,L as k}from"./react-9ItUixmA.js";import{s as S,I as o,C as A,b as B,B as G,d as U}from"./index-DDd0kLwX.js";import{I as M}from"./input-s_SeVYy5.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const ae=()=>{const[a,m]=r.useState([]),[b,p]=r.useState([]),[x,g]=r.useState(!0),[f,_]=r.useState(""),[P,$]=r.useState(""),[R,q]=r.useState(1e6),[j,N]=r.useState(0),[y,v]=r.useState(1e6),[i,w]=r.useState([]),[C,L]=r.useState("newest"),[V,I]=r.useState({}),[u,z]=r.useState(!1),[h,O]=r.useState(!1);r.useEffect(()=>{W()},[]),r.useEffect(()=>{const s=setTimeout(()=>$(f.trim()),300);return()=>clearTimeout(s)},[f]);const W=async()=>{try{g(!0);const{data:s,error:l}=await S.from("productos").select(`
          *,
          categorias(nombre)
        `).eq("estado","activo").eq("archivado",!1).gt("stock",0);if(l)throw l;const{data:t,error:c}=await S.from("categorias").select("*").order("nombre");if(c)throw c;m(s||[]);const T=Math.max(1e5,...(s||[]).map(d=>Number(d.precio||0)));q(T),N(0),v(T);const E=(s||[]).map(d=>d.id);if(E.length>0){const{data:d}=await S.from("mv_promedio_calificaciones").select("producto_id,promedio").in("producto_id",E),D={};(d||[]).forEach(F=>{D[F.producto_id]=Number(F.promedio||0)}),I(D)}else I({});p(t||[])}catch(s){console.error("Error loading data:",s)}finally{g(!1)}},n=r.useMemo(()=>{let s=[...a];const l=P.toLowerCase();switch(l&&(s=s.filter(t=>t.nombre.toLowerCase().includes(l))),i.length>0&&(s=s.filter(t=>i.includes(t.categoria_id||""))),s=s.filter(t=>Number(t.precio)>=j&&Number(t.precio)<=y),C){case"price_asc":s.sort((t,c)=>t.precio-c.precio);break;case"price_desc":s.sort((t,c)=>c.precio-t.precio);break;case"name":s.sort((t,c)=>t.nombre.localeCompare(c.nombre));break;case"newest":default:s.sort((t,c)=>new Date(c.created_at).getTime()-new Date(t.created_at).getTime());break}return s},[a,P,i,j,y,C]);return x?e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"heading-lg mb-2",children:"Catálogo de Productos"}),e.jsx("p",{className:"opacity-80",children:"Descubre productos únicos hechos por artesanos del Chocó"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((s,l)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-40 bg-gray-200 rounded-t-xl"}),e.jsxs("div",{className:"border rounded-b-xl p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"})]})]},l))})]}):e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"rounded-xl h-14 mb-4 overflow-hidden",style:{backgroundImage:"linear-gradient(to right, rgba(0,0,0,0.25), rgba(0,0,0,0.05)), url('/assert/1/v1045-03.jpg')",backgroundSize:"cover",backgroundPosition:"center"}}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[e.jsx("div",{className:"flex-1 w-full md:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{category:"Catálogo y producto",name:"LineMdSearch",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(M,{type:"text",placeholder:"Buscar productos...",value:f,onChange:s=>_(s.target.value),className:"pl-10 bg-card search-input"})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:C,onChange:s=>L(s.target.value),className:"form-select",children:[e.jsx("option",{value:"newest",children:"Más recientes"}),e.jsx("option",{value:"price_asc",children:"Precio: menor a mayor"}),e.jsx("option",{value:"price_desc",children:"Precio: mayor a menor"}),e.jsx("option",{value:"name",children:"Nombre A-Z"})]})})]}),e.jsxs("div",{className:"sm:hidden mt-3 flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn btn-outline btn-sm flex items-center gap-2",onClick:()=>z(s=>!s),"aria-label":u?"Ocultar filtros":"Mostrar filtros",title:u?"Ocultar filtros":"Mostrar filtros",children:[e.jsx(o,{category:"Catálogo y producto",name:"IonFilter",className:"w-4 h-4"}),u?"Ocultar filtros":"Mostrar filtros"]}),e.jsxs("button",{type:"button",className:"btn btn-outline btn-sm flex items-center gap-2",onClick:()=>O(s=>!s),"aria-label":h?"Cambiar a vista 1 columna":"Cambiar a vista 2 columnas",title:h?"Cambiar a vista 1 columna":"Cambiar a vista 2 columnas",children:[e.jsx(o,{category:"Navegación principal",name:"MdiGrid",className:"w-4 h-4"}),h?"Vista 1x":"Vista 2x"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:`lg:col-span-1 ${u?"":"hidden"} lg:block`,children:e.jsx(A,{children:e.jsxs(B,{className:"p-4 sm:p-4 p-3",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(o,{category:"Catálogo y producto",name:"IonFilter",className:"w-4 h-4"}),"Filtros"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(o,{category:"Catálogo y producto",name:"LucideTags",className:"w-4 h-4"}),"Categorías"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:b.map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i.includes(s.id),onChange:l=>{l.target.checked?w([...i,s.id]):w(i.filter(t=>t!==s.id))},className:"rounded"}),s.nombre]},s.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(o,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-4 h-4"}),"Rango de precios"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Mínimo"}),e.jsx(M,{type:"number",value:j,onChange:s=>N(Number(s.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Máximo"}),e.jsx(M,{type:"number",value:y,onChange:s=>v(Number(s.target.value)),className:"w-full"})]})]})]}),e.jsxs(G,{variant:"outline",onClick:()=>{_(""),w([]),N(0),v(R),L("newest")},className:"w-full flex items-center gap-2 sm:py-2 py-2",children:[e.jsx(o,{category:"Estados y Feedback",name:"HugeiconsReload",className:"w-4 h-4"}),"Limpiar filtros"]})]})})}),e.jsxs("div",{className:"min-w-0 lg:col-span-3",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("p",{className:"opacity-80",children:[n.length," producto",n.length!==1?"s":""," encontrado",n.length!==1?"s":""]})}),n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{category:"Catálogo y producto",name:"BxsPackage",className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron productos"}),e.jsx("p",{className:"text-gray-500",children:"Intenta ajustar tus filtros de búsqueda"})]}):e.jsx("div",{className:`grid ${h?"grid-cols-2":"grid-cols-1"} sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 items-stretch content-start`,children:n.map(s=>e.jsx(J,{product:s,avg:V[s.id]},s.id))})]})]})]})},Z=({product:a,avg:m})=>{const{add:b}=U(),p=Number(a.stock)<=5&&Number(a.stock)>0,x=a.created_at?new Date(a.created_at):null,g=x?Date.now()-x.getTime()<1e3*60*60*24*14:!1;return e.jsxs(A,{className:"transition-all overflow-hidden group hover:shadow-xl border-gray-200",children:[e.jsx(k,{to:`/productos/${a.id}`,className:"block",children:e.jsxs("div",{className:"relative bg-gray-100 overflow-hidden aspect-[3/2]",children:[a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,loading:"lazy",decoding:"async",className:"absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"absolute inset-0 w-full h-full flex items-center justify-center text-gray-400",style:{backgroundImage:"linear-gradient(to bottom, rgba(0,0,0,0.10), rgba(0,0,0,0.10)), url('/assert/2/9a92cd16-82e0-4b9b-bc8f-a7805b2ad499.jpg')",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsx(o,{category:"Catálogo y producto",name:"MynauiImage",className:"w-8 h-8"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[a.categorias?.nombre&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-medium bg-surface-90 text-gray-700",children:a.categorias.nombre}),g&&e.jsx("span",{className:"text-[11px] text-white/90",children:"Nuevo"})]})})]})}),e.jsxs(B,{className:"p-4",children:[e.jsx(k,{to:`/productos/${a.id}`,className:"block",children:e.jsx("h3",{className:"text-base font-semibold line-clamp-2 group-hover:text-(--color-terracotta-suave)",children:a.nombre})}),e.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-(--color-terracotta-suave)",children:["$",Number(a.precio).toLocaleString()]}),m!==void 0&&e.jsxs("div",{className:"text-xs text-yellow-600 flex items-center gap-1",children:[e.jsx(o,{category:"Catálogo y producto",name:"LucideHeart",className:"w-3 h-3"}),m.toFixed(1)]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[p?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(o,{category:"Estados y Feedback",name:"MaterialSymbolsWarning",className:"w-3 h-3 mr-1"}),"¡Pocas unidades!"]}):e.jsxs("span",{className:"text-xs text-gray-500",children:["Stock: ",a.stock]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{to:`/productos/${a.id}`,className:"btn btn-outline btn-sm flex items-center gap-1",children:[e.jsx(o,{category:"Catálogo y producto",name:"LineMdSearch",className:"w-3 h-3"}),"Ver"]}),e.jsxs("button",{className:"btn btn-primary btn-sm flex items-center gap-1",onClick:()=>b({productoId:a.id,nombre:a.nombre,precio:Number(a.precio),cantidad:1,imagenUrl:a.imagen_url||void 0,stock:a.stock}),children:[e.jsx(o,{category:"Carrito y checkout",name:"WhhShoppingcart",className:"w-3 h-3"}),"Añadir"]})]})]})]})]})},J=H.memo(Z);export{ae as default};
