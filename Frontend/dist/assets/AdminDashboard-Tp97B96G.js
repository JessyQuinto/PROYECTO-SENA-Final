import{j as e}from"./radix-pxeQr2vL.js";import{b as f,i as S}from"./react-9ItUixmA.js";import{a as k,s as n,I as d}from"./index-DDd0kLwX.js";import{A as C}from"./AdminLayout-C4V03p12.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const U=()=>{const[x,p]=f.useState(null),[h,j]=f.useState([]),[v,y]=f.useState(!0),{success:b,error:N}=k(),u=S();f.useEffect(()=>{w()},[]);const w=async()=>{try{y(!0);const a=new Date;a.setDate(1),a.setHours(0,0,0,0);const[t,i,l,s]=await Promise.all([n.from("users").select("*").eq("role","vendedor"),n.from("productos").select("*"),n.from("orders").select("*"),n.from("orders").select("total, created_at").gte("created_at",a.toISOString())]);if(t.data&&i.data&&l.data){const r=t.data.filter(o=>o.vendedor_estado==="pendiente"),c=(s.data||[]).reduce((o,m)=>o+Number(m.total||0),0);p({totalVendedores:t.data.length,vendedoresPendientes:r.length,totalProductos:i.data.length,totalPedidos:l.data.length,ventasDelMes:c}),j(r.slice(0,5))}}catch(a){console.error("Error loading dashboard data:",a)}finally{y(!1)}},P=async a=>{try{const{error:t}=await n.from("users").update({vendedor_estado:"aprobado"}).eq("id",a);if(t)throw t;let i=!0,l;try{const[{data:s},{data:r}]=await Promise.all([n.from("app_config").select("value").eq("key","notify_vendor_email_enabled").maybeSingle(),n.from("app_config").select("value").eq("key","notify_from").maybeSingle()]);i=s?.value?.enabled??!0,l=r?.value?.from??void 0}catch{}try{const s=h.find(m=>m.id===a),c=(await n.auth.getSession()).data.session?.access_token,o="https://jdmexfawmetmfabpwlfs.supabase.co";if(o&&i){const g=`https://${new URL(o).host.split(".")[0]}.functions.supabase.co/notify-vendor-status`;await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({action:"aprobado",email:s?.email,nombre:s?.nombre_completo,from:l})})}}catch(s){console.warn("[notify] fallo al notificar aprobación (continuando):",s)}j(s=>s.filter(r=>r.id!==a)),p(s=>s?{...s,vendedoresPendientes:s.vendedoresPendientes-1}:null),b("Vendedor aprobado exitosamente",{role:"admin",action:"approve"})}catch(t){console.error("Error approving vendor:",t),N("Error al aprobar vendedor",{role:"admin",action:"approve"})}},_=async a=>{try{const{error:t}=await n.from("users").update({vendedor_estado:"rechazado"}).eq("id",a);if(t)throw t;let i=!0,l;try{const[{data:s},{data:r}]=await Promise.all([n.from("app_config").select("value").eq("key","notify_vendor_email_enabled").maybeSingle(),n.from("app_config").select("value").eq("key","notify_from").maybeSingle()]);i=s?.value?.enabled??!0,l=r?.value?.from??void 0}catch{}try{const s=h.find(m=>m.id===a),c=(await n.auth.getSession()).data.session?.access_token,o="https://jdmexfawmetmfabpwlfs.supabase.co";if(o&&i){const g=`https://${new URL(o).host.split(".")[0]}.functions.supabase.co/notify-vendor-status`;await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({action:"rechazado",email:s?.email,nombre:s?.nombre_completo,from:l})})}}catch(s){console.warn("[notify] fallo al notificar rechazo (continuando):",s)}j(s=>s.filter(r=>r.id!==a)),p(s=>s?{...s,vendedoresPendientes:s.vendedoresPendientes-1}:null),b("Vendedor rechazado",{role:"admin",action:"reject"})}catch(t){console.error("Error rejecting vendor:",t),N("Error al rechazar vendedor",{role:"admin",action:"reject"})}};return v?e.jsx("div",{className:"container py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"loading-spinner w-8 h-8"})})}):e.jsxs(C,{title:"Panel de Administración",subtitle:"Gestiona vendedores, productos y supervisa las métricas del marketplace",children:[x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 text-blue-600",children:e.jsx(d,{category:"Administrador",name:"Users",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Vendedores"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.totalVendedores})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-yellow-100 text-yellow-600",children:e.jsx(d,{category:"Pedidos",name:"CarbonPendingFilled",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.vendedoresPendientes})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-100 text-green-600",children:e.jsx(d,{category:"Catálogo y producto",name:"BxsPackage",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Productos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.totalProductos})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-100 text-purple-600",children:e.jsx(d,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Pedidos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.totalPedidos})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-indigo-100 text-indigo-600",children:e.jsx(d,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Ventas del Mes"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",x.ventasDelMes]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Vendedores Pendientes de Aprobación"})}),e.jsx("div",{className:"card-body",children:h.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay vendedores pendientes"}):e.jsx("div",{className:"space-y-4",children:h.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a.nombre_completo||a.email}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Registrado: ",new Date(a.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(a.id),className:"btn btn-accent btn-sm",children:"Aprobar"}),e.jsx("button",{onClick:()=>_(a.id),className:"btn btn-danger btn-sm",children:"Rechazar"})]})]},a.id))})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Acciones Rápidas"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{className:"w-full btn btn-primary justify-start",onClick:()=>u("/admin/categorias"),children:[e.jsx(d,{category:"Navegación principal",name:"MdiGrid",className:"w-5 h-5 mr-2"}),"Crear Nueva Categoría"]}),e.jsxs("button",{className:"w-full btn btn-outline justify-start",onClick:()=>u("/admin/metricas"),children:[e.jsx(d,{category:"Administrador",name:"BarChart3",className:"w-5 h-5 mr-2"}),"Ver Métricas Detalladas"]}),e.jsxs("button",{className:"w-full btn btn-outline justify-start",onClick:()=>u("/admin/usuarios"),children:[e.jsx(d,{category:"Administrador",name:"Users",className:"w-5 h-5 mr-2"}),"Gestionar Usuarios"]}),e.jsxs("button",{className:"w-full btn btn-outline justify-start",onClick:()=>u("/admin/moderacion"),children:[e.jsx(d,{category:"Administrador",name:"Gavel",className:"w-5 h-5 mr-2"}),"Moderación de Contenido"]})]})})]})]})]})};export{U as default};
