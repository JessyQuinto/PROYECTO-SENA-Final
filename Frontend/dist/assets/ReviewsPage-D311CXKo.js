import{j as e}from"./radix-pxeQr2vL.js";import{b as o}from"./react-9ItUixmA.js";import{I as r,s as u}from"./index-DDd0kLwX.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const N=()=>{const[t,l]=o.useState([]),[i,n]=o.useState(!0),c=async()=>{n(!0);const{data:a}=await u.from("order_items").select("id, producto_id, producto_nombre, order_id, orders!inner(id, estado), evaluaciones(id)").eq("orders.estado","entregado");l(a||[]),n(!1)};o.useEffect(()=>{c()},[]);const m=async(a,s,p)=>{try{const{error:d}=await u.from("evaluaciones").insert({comprador_id:(await u.auth.getUser()).data.user?.id,producto_id:a.producto_id,order_item_id:a.id,puntuacion:s,comentario:p||null});if(d)throw d;await c(),alert("¡Gracias por tu calificación!")}catch(d){alert(d?.message||"No se pudo enviar la calificación")}};return e.jsxs("div",{className:"container py-8",children:[e.jsxs("h1",{className:"heading-lg mb-6 flex items-center gap-3",children:[e.jsx(r,{category:"Catálogo y producto",name:"LucideHeart",className:"w-8 h-8"}),"Calificar compras"]}),i?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(r,{category:"Estados y Feedback",name:"HugeiconsReload",className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando..."})]}):t.length===0?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center text-gray-600",children:[e.jsx(r,{category:"Catálogo y producto",name:"LucideHeart",className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),"No tienes compras entregadas por calificar"]})}):e.jsx("div",{className:"space-y-3",children:t.map(a=>e.jsx(x,{item:a,onSubmit:m},a.id))})]})},x=({item:t,onSubmit:l})=>{const[i,n]=o.useState(5),[c,m]=o.useState(""),a=t.evaluaciones&&t.evaluaciones.length>0;return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium flex items-center gap-2",children:[e.jsx(r,{category:"Catálogo y producto",name:"BxsPackage",className:"w-4 h-4"}),t.producto_nombre]}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(r,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-3 h-3"}),"Pedido #",t.order_id?.slice(0,8)]})]}),a?e.jsxs("span",{className:"badge badge-secondary flex items-center gap-1",children:[e.jsx(r,{category:"Estados y Feedback",name:"IconParkSolidSuccess",className:"w-3 h-3"}),"Ya calificado"]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{className:"form-select w-28",value:i,onChange:s=>n(Number(s.target.value)),children:[5,4,3,2,1].map(s=>e.jsxs("option",{value:s,children:[s," estrellas"]},s))}),e.jsx("input",{className:"form-input",placeholder:"Comentario (opcional)",value:c,onChange:s=>m(s.target.value)}),e.jsxs("button",{className:"btn btn-primary flex items-center gap-2",onClick:()=>l(t,i,c),children:[e.jsx(r,{category:"Catálogo y producto",name:"LucideHeart",className:"w-4 h-4"}),"Enviar"]})]})]})})};export{N as default};
