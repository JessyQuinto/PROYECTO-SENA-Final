import{j as e}from"./radix-pxeQr2vL.js";import{j as y,b as u,L as j}from"./react-9ItUixmA.js";import{I as a,s as p}from"./index-DDd0kLwX.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const N=({title:i,subtitle:l,children:h})=>{const d=[{group:"Compras",items:[{to:"/productos",label:"Explorar",icon:e.jsx(a,{category:"Catálogo y producto",name:"LineMdSearch",className:"w-4 h-4"})},{to:"/mis-pedidos",label:"Mis pedidos",icon:e.jsx(a,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-4 h-4"})},{to:"/mis-calificaciones",label:"Calificaciones",icon:e.jsx(a,{category:"Catálogo y producto",name:"LucideHeart",className:"w-4 h-4"})}]}];return e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"rounded-xl h-14 mb-3 overflow-hidden",style:{backgroundImage:"linear-gradient(to right, rgba(0,0,0,0.18), rgba(0,0,0,0.04)), url('/assert/1/v1045-03.jpg')",backgroundSize:"cover",backgroundPosition:"center"}}),e.jsx("h1",{className:"heading-lg mb-1",children:i}),l&&e.jsx("p",{className:"text-gray-600",children:l})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("aside",{className:"lg:col-span-3",children:e.jsx("div",{className:"sticky top-20",children:e.jsx("div",{className:"rounded-xl border border-(--color-border) overflow-hidden bg-white shadow-sm",children:d.map(t=>e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"px-4 py-2 text-xs font-semibold tracking-wide uppercase text-gray-500",children:t.group}),e.jsx("nav",{className:"px-2 pb-2 space-y-1",children:t.items.map(r=>e.jsxs(y,{to:r.to,className:({isActive:x})=>`group flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${x?"bg-(--color-marfil) text-(--color-marron-cacao) shadow-inner":"text-gray-700 hover:bg-(--color-marfil)"}`,children:[e.jsx("span",{className:"opacity-70 group-hover:opacity-100",children:r.icon}),e.jsx("span",{className:"text-sm font-medium",children:r.label})]},r.to))})]},t.group))})})}),e.jsx("main",{className:"lg:col-span-9",children:e.jsx("div",{className:"rounded-xl border border-(--color-border) bg-white shadow-sm",children:e.jsx("div",{className:"p-4 md:p-6",children:h})})})]})]})},C=()=>{const[i,l]=u.useState([]),[h,d]=u.useState(!0),t=async()=>{d(!0);const{data:s}=await p.from("orders").select("id,total,estado,created_at").order("created_at",{ascending:!1});l(s||[]),d(!1)};u.useEffect(()=>{t()},[]);const r=async()=>{if(confirm("¿Eliminar tu cuenta? Esta acción es irreversible."))try{const c=(await p.auth.getSession()).data.session?.access_token,o="https://jdmexfawmetmfabpwlfs.supabase.co";if(o&&c){const m=new URL(o).host.split(".")[0],n=await fetch(`https://${m}.functions.supabase.co/self-account`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}}),g=await n.json();if(!n.ok)throw new Error(g?.error||"No se pudo eliminar");window.toast?.success("Cuenta eliminada",{action:"delete"}),await p.auth.signOut(),window.location.href="/"}}catch(s){window.toast?.error(s?.message||"No se pudo eliminar la cuenta",{action:"delete"})}},x=async s=>{try{const o=(await p.auth.getSession()).data.session?.access_token,m="http://localhost:4000";if(!m||!o)throw new Error("Backend no configurado");const n=await fetch(`${m.replace(/\/$/,"")}/orders/${s}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}),g=await n.json();if(!n.ok)throw new Error(g?.error||"No se pudo cancelar");await t(),window.toast?.success("Pedido cancelado",{role:"comprador",action:"cancel"})}catch(c){window.toast?.error(c?.message||"No se pudo cancelar",{role:"comprador",action:"cancel"})}};return e.jsxs(N,{title:"Mis Pedidos",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2",children:[e.jsx(a,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-5 h-5"}),"Mis pedidos"]}),e.jsxs("button",{className:"btn btn-outline btn-sm flex items-center gap-2",onClick:r,children:[e.jsx(a,{category:"Estados y Feedback",name:"BxErrorCircle",className:"w-4 h-4"}),"Eliminar mi cuenta"]})]}),h?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(a,{category:"Estados y Feedback",name:"HugeiconsReload",className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando..."})]}):i.length===0?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center text-gray-600",children:[e.jsx(a,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),"No tienes pedidos"]})}):e.jsx("div",{className:"card card-hover",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsxs("th",{className:"py-2 pr-4 flex items-center gap-2",children:[e.jsx(a,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-4 h-4"}),"ID"]}),e.jsxs("th",{className:"py-2 pr-4 flex items-center gap-2",children:[e.jsx(a,{category:"Estados y Feedback",name:"IconoirWarningSquare",className:"w-4 h-4"}),"Fecha"]}),e.jsxs("th",{className:"py-2 pr-4 flex items-center gap-2",children:[e.jsx(a,{category:"Pedidos",name:"CarbonPendingFilled",className:"w-4 h-4"}),"Estado"]}),e.jsxs("th",{className:"py-2 pr-4 flex items-center gap-2",children:[e.jsx(a,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-4 h-4"}),"Total"]}),e.jsxs("th",{className:"py-2 flex items-center gap-2",children:[e.jsx(a,{category:"Navegación principal",name:"MdiGrid",className:"w-4 h-4"}),"Acciones"]})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-4 font-mono",children:e.jsxs(j,{to:`/pedido/${s.id}`,className:"nav-link",children:["#",s.id.slice(0,8)]})}),e.jsx("td",{className:"py-2 pr-4",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"py-2 pr-4",children:s.estado}),e.jsxs("td",{className:"py-2 pr-4 font-semibold",children:["$",Number(s.total).toFixed(0)]}),e.jsxs("td",{className:"py-2 flex items-center gap-2",children:[e.jsxs(j,{to:`/pedido/${s.id}`,className:"btn btn-primary btn-sm flex items-center gap-1",children:[e.jsx(a,{category:"Catálogo y producto",name:"LineMdSearch",className:"w-3 h-3"}),"Ver"]}),["procesando","enviado","entregado"].includes(s.estado)&&e.jsxs(j,{to:`/recibo/${s.id}`,className:"btn btn-secondary btn-sm flex items-center gap-1",children:[e.jsx(a,{category:"Carrito y checkout",name:"TablerDownload",className:"w-3 h-3"}),"Ver recibo"]}),s.estado==="pendiente"&&e.jsxs("button",{className:"btn btn-outline btn-sm flex items-center gap-1",onClick:()=>x(s.id),children:[e.jsx(a,{category:"Pedidos",name:"IxCancelled",className:"w-3 h-3"}),"Cancelar"]})]})]},s.id))})]})})})]})};export{C as default};
