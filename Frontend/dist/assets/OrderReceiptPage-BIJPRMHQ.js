const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-BGng-i1c.js","assets/supabase-D999gSRu.js","assets/react-9ItUixmA.js"])))=>i.map(i=>d[i]);
import{_}from"./supabase-D999gSRu.js";import{j as e}from"./radix-pxeQr2vL.js";import{k as T,b as c,L as A}from"./react-9ItUixmA.js";import{s as u,I as a}from"./index-DDd0kLwX.js";import"./shadcn_misc-DPVfRoQl.js";const z=()=>{const{id:h}=T(),[t,S]=c.useState(null),[P,j]=c.useState(!0),[i,k]=c.useState(null),x=c.useRef(null),[f,N]=c.useState(!1),C=async()=>{if(!x.current||!t)return;const s=x.current,[r,n]=await Promise.all([_(()=>import("./pdf-BGng-i1c.js").then(g=>g.h),__vite__mapDeps([0,1,2])),_(()=>import("./pdf-BGng-i1c.js").then(g=>g.j),__vite__mapDeps([0,1,2]))]),o=r.default||r,p=n.jsPDF||n.default,l=await o(s,{scale:2,backgroundColor:"#ffffff",useCORS:!0}),D=l.toDataURL("image/png"),d=new p("p","mm","a4"),b=d.internal.pageSize.getWidth(),L=d.internal.pageSize.getHeight(),m={width:l.width,height:l.height},v=Math.min(b/m.width,L/m.height),w=m.width*v,I=m.height*v,F=(b-w)/2;d.addImage(D,"PNG",F,10,w,I);const M=`recibo-${t.invoice_number||String(t.id).slice(0,8)}.pdf`;d.save(M)},E=async()=>{if(t)try{N(!0);const s=(await u.auth.getSession()).data.session,r=s?.access_token,n=s?.user?.email,o="https://jdmexfawmetmfabpwlfs.supabase.co";if(!r||!o||!n)throw new Error("Sesión no disponible");const p=new URL(o).host.split(".")[0];if(!(await fetch(`https://${p}.functions.supabase.co/order-emails`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({action:"receipt",email:n,order_id:t.id})})).ok)throw new Error("No se pudo enviar el correo");window.toast?.success("Recibo enviado a tu correo")}catch(s){window.toast?.error(s?.message||"No se pudo enviar el correo")}finally{N(!1)}};if(c.useEffect(()=>{(async()=>{j(!0);const[{data:s},{data:r}]=await Promise.all([u.from("orders").select(`id,total,estado,created_at,comprador_id,invoice_number,
          order_items(id,cantidad,precio_unitario,subtotal,producto_nombre,producto_imagen_url),
          users!orders_comprador_id_fkey(email)
        `).eq("id",h).maybeSingle(),u.from("order_shipping").select("*").eq("order_id",h).maybeSingle()]);S(s),k(r),j(!1)})()},[h]),P)return e.jsx("div",{className:"container py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(a,{category:"Estados y Feedback",name:"HugeiconsReload",className:"w-8 h-8 animate-spin"})})});if(!t)return e.jsx("div",{className:"container py-8",children:"Pedido no encontrado"});const R=new Date(t.created_at),y=t.order_items||[];return e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"heading-lg flex items-center gap-3",children:[e.jsx(a,{category:"Carrito y checkout",name:"TablerDownload",className:"w-8 h-8"}),"Recibo de compra"]}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(a,{category:"Estados y Feedback",name:"IconoirWarningSquare",className:"w-4 h-4"}),"Pedido ",t.invoice_number||"#"+String(t.id).slice(0,8)," · ",R.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{to:`/pedido/${t.id}`,className:"btn btn-primary flex items-center gap-2",children:[e.jsx(a,{category:"Catálogo y producto",name:"LineMdSearch",className:"w-4 h-4"}),"Ver detalle"]}),e.jsxs("button",{onClick:C,className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(a,{category:"Carrito y checkout",name:"TablerDownload",className:"w-4 h-4"}),"Descargar PDF"]}),e.jsxs("button",{onClick:()=>window.print(),className:"btn btn-outline flex items-center gap-2",children:[e.jsx(a,{category:"Archivos e imagenes",name:"StreamlineInterfaceDownloadButton2ArrowBottomDownDownloadInternetNetworkServerUpload",className:"w-4 h-4"}),"Imprimir"]}),e.jsxs("button",{onClick:E,disabled:f,className:"btn btn-outline flex items-center gap-2",children:[e.jsx(a,{category:"Autenticacion",name:"MdiMail",className:"w-4 h-4"}),f?"Enviando…":"Reenviar correo"]})]})]}),e.jsxs("div",{ref:x,id:"receiptRoot",className:"grid grid-cols-1 lg:grid-cols-3 gap-6 print:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2 card card-hover",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(a,{category:"Navegación principal",name:"FaSolidStore",className:"w-6 h-6"}),"Tesoros Chocó"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Recibo electrónico"})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(a,{category:"Pedidos",name:"CarbonPendingFilled",className:"w-3 h-3"}),"Estado"]}),e.jsx("p",{className:"font-semibold capitalize",children:t.estado})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(a,{category:"Catálogo y producto",name:"BxsPackage",className:"w-5 h-5"}),"Productos"]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Producto"}),e.jsx("th",{className:"py-2 pr-4",children:"Cantidad"}),e.jsx("th",{className:"py-2 pr-4",children:"Unitario"}),e.jsx("th",{className:"py-2 pr-4",children:"Subtotal"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-3 pr-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.producto_imagen_url&&e.jsx("img",{src:s.producto_imagen_url,alt:s.producto_nombre,className:"w-10 h-10 object-cover rounded"}),e.jsx("span",{className:"font-medium",children:s.producto_nombre})]})}),e.jsx("td",{className:"py-3 pr-4",children:s.cantidad}),e.jsxs("td",{className:"py-3 pr-4",children:["$",Number(s.precio_unitario).toLocaleString()]}),e.jsxs("td",{className:"py-3 pr-4 font-semibold",children:["$",Number(s.subtotal).toLocaleString()]})]},s.id))})]})]})]})}),e.jsx("div",{className:"card card-hover h-max",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(a,{category:"Autenticacion",name:"MdiMail",className:"w-4 h-4"}),"Correo comprador"]}),e.jsx("span",{className:"font-medium",children:t.users?.email})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(a,{category:"Carrito y checkout",name:"HugeiconsMapsLocation01",className:"w-4 h-4"}),"Envío"]}),i?e.jsxs("div",{className:"text-gray-800",children:[e.jsx("div",{children:i.nombre}),e.jsx("div",{children:i.direccion}),e.jsx("div",{children:i.ciudad}),e.jsx("div",{children:i.telefono})]}):e.jsx("div",{className:"text-gray-500",children:"Sin información de envío"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(a,{category:"Catálogo y producto",name:"BxsPackage",className:"w-4 h-4"}),"Artículos"]}),e.jsx("span",{className:"font-medium",children:y.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(a,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-4 h-4"}),"Total"]}),e.jsxs("span",{className:"text-2xl font-bold text-(--color-terracotta-suave)",children:["$",Number(t.total).toLocaleString()]})]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-2",children:[e.jsx(a,{category:"Estados y Feedback",name:"TypcnInfoLarge",className:"w-3 h-3"}),"Este es un comprobante electrónico generado para el flujo educativo. Conserva este número de pedido para consultas."]})]})})]})]})};export{z as default};
