import{j as e}from"./radix-pxeQr2vL.js";import{i as S,u as w,b as s,L as I}from"./react-9ItUixmA.js";import{s as h,B as L}from"./index-DDd0kLwX.js";import{I as g}from"./input-s_SeVYy5.js";import{L as v}from"./label-BStnk5CR.js";import"./supabase-D999gSRu.js";import"./shadcn_misc-DPVfRoQl.js";const V=120,q=()=>{const c=S(),d=w(),[m,b]=s.useState(V),n=s.useMemo(()=>d?.state?.email,[d?.state]),[l,j]=s.useState(""),[u,y]=s.useState(""),[p,o]=s.useState(!1),[x,i]=s.useState(null);s.useEffect(()=>{const a=setInterval(()=>b(t=>t>0?t-1:0),1e3);return()=>clearInterval(a)},[]),s.useEffect(()=>{const a=h?.auth.onAuthStateChange((t,r)=>{r?.user&&c("/login",{replace:!0})});return()=>{a?.data?.subscription?.unsubscribe?.()}},[c]);const N=Math.floor(m/60),C=String(m%60).padStart(2,"0"),E=async a=>{a.preventDefault(),i(null);const t=n||u;if(!t){i("Ingresa tu email");return}if(!l||l.length<6){i("Código inválido");return}o(!0);try{const{data:r,error:f}=await h.auth.verifyOtp({email:t,token:l,type:"signup"});if(f){i(f.message),o(!1);return}if(r?.session?.user){try{window.toast?.success("Correo verificado. Inicia sesión.")}catch{}c("/login",{replace:!0})}else{try{window.toast?.success("Correo verificado. Inicia sesión.")}catch{}c("/login",{replace:!0})}}catch(r){i(r?.message||"No se pudo verificar el código")}finally{o(!1)}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] grid place-items-center",children:e.jsx("div",{className:"container max-w-xl",children:e.jsx("div",{className:"card card-hover",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"mb-3 text-sm uppercase tracking-wide font-semibold text-(--color-terracotta-suave)",children:"Verifica tu correo"}),e.jsx("h1",{className:"text-2xl font-semibold mb-2 font-display",children:"Te enviamos un enlace de confirmación"}),e.jsx("p",{className:"opacity-80 mb-4",children:n?e.jsxs(e.Fragment,{children:["Revisa ",e.jsx("b",{children:n})," y haz clic en “Confirmar mi cuenta”."]}):"Revisa tu bandeja de entrada y haz clic en “Confirmar mi cuenta”."}),e.jsxs("div",{className:"text-4xl font-bold tabular-nums mb-2",children:[N,":",C]}),e.jsx("p",{className:"text-sm opacity-70 mb-6",children:"Este tiempo es orientativo. El enlace de Supabase puede expirar antes según la configuración del proyecto."}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(I,{className:"btn",to:"/login",children:"Ir a iniciar sesión"}),e.jsx("button",{className:"btn-ghost",onClick:()=>window.location.reload(),children:"Actualizar"})]}),e.jsxs("div",{className:"mt-8 text-left",children:[e.jsx("h2",{className:"text-base font-semibold mb-2",children:"¿Tienes un código de verificación?"}),e.jsx("p",{className:"text-sm opacity-80 mb-4",children:"Introduce el código que recibiste en el correo para verificar tu cuenta."}),x&&e.jsx("div",{className:"mb-4 rounded-lg bg-red-50 text-red-700 px-3 py-2 text-sm",children:x}),e.jsxs("form",{className:"grid gap-3 md:grid-cols-3",onSubmit:E,children:[!n&&e.jsxs("div",{className:"md:col-span-2 space-y-1",children:[e.jsx(v,{htmlFor:"verif-email",children:"Email"}),e.jsx(g,{id:"verif-email",type:"email",placeholder:"tu@email.com",value:u,onChange:a=>y(a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(v,{htmlFor:"otp",children:"Código"}),e.jsx(g,{id:"otp",inputMode:"numeric",placeholder:"123456",value:l,onChange:a=>j(a.target.value.replace(/\D/g,"")),maxLength:6})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(L,{type:"submit",className:"w-full",disabled:p,children:p?"Verificando…":"Verificar"})})]}),e.jsx("p",{className:"text-xs opacity-70 mt-2",children:"Si tu correo dice “También puedes usar este código de verificación”, cópialo aquí."})]})]})})})})};export{q as default};
