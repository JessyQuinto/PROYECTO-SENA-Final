import{j as e}from"./radix-pxeQr2vL.js";import{j as he,b as c,u as fe}from"./react-9ItUixmA.js";import{I as r,u as be,s as i}from"./index-DDd0kLwX.js";import{o as je,s as O,d as ae,l as ve}from"./shadcn_misc-DPVfRoQl.js";import"./supabase-D999gSRu.js";const Ne=({title:d,subtitle:f,children:_})=>{const C=[{group:"Gestión",items:[{to:"/vendedor",label:"Resumen",icon:e.jsx(r,{category:"Navegación principal",name:"MdiHome",className:"w-4 h-4"})}]},{group:"Ventas",items:[{to:"/vendedor#products",label:"Mis productos",icon:e.jsx(r,{category:"Vendedor",name:"SiInventoryFill",className:"w-4 h-4"})},{to:"/vendedor#orders",label:"Pedidos",icon:e.jsx(r,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-4 h-4"})},{to:"/vendedor#add",label:"Agregar producto",icon:e.jsx(r,{category:"Vendedor",name:"LucideCircleFadingPlus",className:"w-4 h-4"})}]},{group:"Sistema",items:[{to:"/vendedor#config",label:"Configuración",icon:e.jsx(r,{category:"Usuario",name:"RivetIconsSettings",className:"w-4 h-4"})}]}];return e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"heading-lg mb-1 flex items-center gap-3",children:[e.jsx(r,{category:"Vendedor",name:"MaterialSymbolsDashboard",className:"w-8 h-8"}),d]}),f&&e.jsxs("p",{className:"text-gray-600 flex items-center gap-2",children:[e.jsx(r,{category:"Estados y Feedback",name:"TypcnInfoLarge",className:"w-4 h-4"}),f]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("aside",{className:"lg:col-span-3",children:e.jsx("div",{className:"sticky top-20",children:e.jsx("div",{className:"rounded-xl border border-(--color-border) overflow-hidden bg-white shadow-sm",children:C.map(y=>e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold tracking-wide uppercase text-gray-500 flex items-center gap-2",children:[e.jsx(r,{category:"Navegación principal",name:"MdiGrid",className:"w-3 h-3"}),y.group]}),e.jsx("nav",{className:"px-2 pb-2 space-y-1",children:y.items.map(b=>e.jsxs(he,{to:b.to,className:({isActive:$})=>`
                          group flex items-center gap-3 px-3 py-2 rounded-lg transition-colors
                          ${$?"bg-(--color-marfil) text-(--color-marron-cacao) shadow-inner":"text-gray-700 hover:bg-(--color-marfil)"}
                        `,children:[e.jsx("span",{className:"opacity-70 group-hover:opacity-100",children:b.icon}),e.jsx("span",{className:"text-sm font-medium",children:b.label})]},b.to))})]},y.group))})})}),e.jsx("main",{className:"lg:col-span-9",children:e.jsx("div",{className:"rounded-xl border border-(--color-border) bg-white shadow-sm",children:e.jsx("div",{className:"p-4 md:p-6",children:_})})})]})]})},ye=je({nombre:O().min(3,"Nombre demasiado corto"),descripcion:O().optional(),precio:ae.number().positive("Precio debe ser positivo"),stock:ae.number().int().min(0,"Stock inválido"),categoria_id:O().uuid("Categoría inválida").optional().or(ve("")),imagen_url:O().url().optional().nullable()}),Ue=()=>{const{user:d}=be(),[f,_]=c.useState(null),[C,y]=c.useState([]),[b,$]=c.useState([]),[L,F]=c.useState([]),[se,I]=c.useState(!0),[j,p]=c.useState("products"),V=fe(),[te,re]=c.useState([]),[R,T]=c.useState(!1),[n,v]=c.useState({nombre:"",descripcion:"",precio:"",stock:"",categoria_id:"",imagen_file:null,imagen_url:null}),[x,N]=c.useState({}),[B,U]=c.useState(null),[D,M]=c.useState({}),[z,q]=c.useState(""),[H,G]=c.useState(!1),[Q,W]=c.useState("activo"),[J,K]=c.useState(!0),[X,Y]=c.useState(!0),[oe,Z]=c.useState(!1),[we,ke]=c.useState(""),[Se,_e]=c.useState("all"),[Ce,Pe]=c.useState("all");c.useEffect(()=>{d?.id&&(A(),ce())},[d]);const ce=async()=>{if(d?.id)try{const a=`vendor_settings:${d.id}`,{data:s}=await i.from("app_config").select("value").eq("key",a).maybeSingle(),t=s?.value||{};M(t),q(t.bio||""),G(!!t.hideOOS),W(t.defaultProductStatus==="inactivo"?"inactivo":"activo"),K(t.notifNewOrder!==!1),Y(t.notifItemShipped!==!1)}catch{}},ie=async()=>{if(!d?.id)return;const a=`vendor_settings:${d.id}`,s={bio:z,hideOOS:H,defaultProductStatus:Q,notifNewOrder:J,notifItemShipped:X,logoUrl:D.logoUrl||null};await i.from("app_config").upsert({key:a,value:s}),window.toast?.success("Configuración guardada",{role:"vendedor",action:"update"}),M(s)},de=async a=>{if(d?.id)try{Z(!0);const s=`${d.id}/vendor-profile/logo-${crypto.randomUUID()}-${a.name}`,{error:t}=await i.storage.from("product-images").upload(s,a,{cacheControl:"3600",upsert:!1});if(t)throw t;const{data:o}=i.storage.from("product-images").getPublicUrl(s),l=o.publicUrl;M(m=>({...m,logoUrl:l})),window.toast?.success("Logo actualizado",{role:"vendedor",action:"update"})}catch(s){window.toast?.error(s?.message||"No se pudo subir el logo",{role:"vendedor",action:"update"})}finally{Z(!1)}};c.useEffect(()=>{const a=(V.hash||"").toLowerCase();a==="#products"?p("products"):a==="#orders"?p("orders"):a==="#add"?p("add-product"):a==="#config"&&p("config")},[V.hash]);const P=a=>{p(a);const s=a==="products"?"#products":a==="orders"?"#orders":a==="add-product"?"#add":"#config";try{window.location.hash=s}catch{}},A=async()=>{if(d?.id)try{I(!0);const{data:a,error:s}=await i.from("productos").select("*").eq("vendedor_id",d.id);if(s)throw s;const{data:t,error:o}=await i.from("order_items").select(`
          id, cantidad, subtotal, enviado, created_at, order_id,
          orders!inner(id, total, estado, created_at, comprador_id),
          users!orders_comprador_id_fkey(email),
          producto_nombre
        `).eq("vendedor_id",d.id);if(o)throw o;const{data:l}=await i.from("categorias").select("id,nombre").order("nombre");re(l||[]);const m=new Date;m.setDate(1),m.setHours(0,0,0,0);const{data:E}=await i.rpc("kpi_mes_vendedor",{inicio:m.toISOString()}),g=E?.[0]||{total_ventas:0,pedidos:0};if(a){y(a);const w=a.filter(k=>k.estado==="activo");_({totalProductos:a.length,productosActivos:w.length,totalPedidos:Number(g.pedidos||0),ventasDelMes:Number(g.total_ventas||0)})}if(t){const w=t.reduce((u,h)=>(u.find(ge=>ge.id===h.orders.id)||u.push({id:h.orders.id,total:h.orders.total,estado:h.orders.estado,created_at:h.orders.created_at,comprador_email:h.users?.email}),u),[]);$(w);const k=t.map(u=>({id:u.id,order_id:u.order_id,producto_nombre:u.producto_nombre,cantidad:u.cantidad,enviado:!!u.enviado,created_at:u.created_at}));F(k)}}catch(a){console.error("Error loading vendor data:",a)}finally{I(!1)}},ne=async(a,s)=>{const t=s==="activo"?"inactivo":"activo";try{const{error:o}=await i.from("productos").update({estado:t}).eq("id",a);if(o)throw o;y(l=>l.map(m=>m.id===a?{...m,estado:t}:m)),_(l=>{if(!l)return null;const m=t==="activo"?1:-1;return{...l,productosActivos:l.productosActivos+m}})}catch(o){console.error("Error updating product status:",o),alert("Error al actualizar el estado del producto")}},le=async(a,s)=>{try{const{error:t}=await i.from("productos").update({archivado:s}).eq("id",a);if(t)throw t;y(o=>o.filter(l=>s?l.id!==a:!0)),window.toast?.success(s?"Producto archivado":"Producto restaurado",{role:"vendedor",action:"update"})}catch(t){window.toast?.error(t?.message||"No se pudo archivar/restaurar",{role:"vendedor",action:"update"})}},ee=()=>{v({nombre:"",descripcion:"",precio:"",stock:"",categoria_id:"",imagen_file:null,imagen_url:null,id:void 0}),N({})},me=async()=>{if(!n.imagen_file)return n.imagen_url||void 0;const a=n.imagen_file,s=`${d.id}/${crypto.randomUUID()}-${a.name}`,{error:t}=await i.storage.from("product-images").upload(s,a,{cacheControl:"3600",upsert:!1});if(t)throw t;const{data:o}=i.storage.from("product-images").getPublicUrl(s);return o.publicUrl},ue=async a=>{if(a.preventDefault(),U(null),!!d?.id){T(!0);try{const s=await me(),t=ye.safeParse({nombre:n.nombre,descripcion:n.descripcion||void 0,precio:n.precio,stock:n.stock,categoria_id:t.data.categoria_id||void 0,imagen_url:s});if(!t.success){U(t.error.errors[0]?.message||"Datos inválidos"),T(!1);return}if(n.id){const{error:o}=await i.from("productos").update({nombre:t.data.nombre,descripcion:t.data.descripcion||null,precio:t.data.precio,stock:t.data.stock,categoria_id:t.data.categoria_id||null,imagen_url:t.data.imagen_url||null}).eq("id",n.id);if(o)throw o;const l=`product_story:${n.id}`;await i.from("app_config").upsert({key:l,value:{historia:(x.historia||"").trim()||null,materiales:(x.materiales||"").trim()||null,tecnica:(x.tecnica||"").trim()||null,origen:(x.origen||"").trim()||null,cuidados:(x.cuidados||"").trim()||null}}),window.toast?.success("Producto actualizado",{role:"vendedor",action:"update"})}else{const{error:o}=await i.from("productos").insert({vendedor_id:d.id,nombre:t.data.nombre,descripcion:t.data.descripcion||null,precio:t.data.precio,stock:t.data.stock,categoria_id:t.data.categoria_id||null,imagen_url:t.data.imagen_url||null,estado:"activo"});if(o)throw o;window.toast?.success("Producto creado",{role:"vendedor",action:"sale"})}await A(),ee(),p("products")}catch(s){U(s?.message||"No se pudo guardar el producto"),window.toast?.error(s?.message||"No se pudo guardar el producto",{role:"vendedor",action:"update"})}finally{T(!1)}}},xe=a=>{p("add-product"),v({id:a.id,nombre:a.nombre,descripcion:"",precio:String(a.precio),stock:String(a.stock),categoria_id:"",imagen_file:null,imagen_url:a.imagen_url||null}),(async()=>{try{const s=`product_story:${a.id}`,{data:t}=await i.from("app_config").select("value").eq("key",s).maybeSingle();N(t?.value||{})}catch{N({})}})()},pe=async a=>{try{const t=(await i.auth.getSession()).data.session?.access_token,o="http://localhost:4000";if(!o||!t)throw new Error("Backend no configurado");const l=await fetch(`${o.replace(/\/$/,"")}/order-items/${a}/shipped`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),m=await l.json();if(!l.ok)throw new Error(m?.error||"No se pudo marcar enviado");F(E=>E.map(g=>g.id===a?{...g,enviado:!0}:g)),await A();try{const g=(await i.auth.getSession()).data.session?.access_token,w="https://jdmexfawmetmfabpwlfs.supabase.co";if(w&&g){const k=L.find(S=>S.id===a),h=b.find(S=>S.id===k?.order_id)?.comprador_email;if(h){const S=new URL(w).host.split(".")[0];await fetch(`https://${S}.functions.supabase.co/order-emails`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({action:"shipped",email:h,order_id:k?.order_id})})}}}catch{}}catch(s){window.toast?.error(s?.message||"No se pudo marcar enviado",{role:"vendedor",action:"ship"})}};return d?.role!=="vendedor"?e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Acceso Denegado"}),e.jsx("p",{className:"text-gray-600",children:"Solo los vendedores pueden acceder a esta página."})]})}):d.vendedor_estado!=="aprobado"?e.jsx("div",{className:"container py-8",children:e.jsx("div",{className:"card max-w-2xl mx-auto",children:e.jsx("div",{className:"card-body text-center",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Cuenta Pendiente de Aprobación"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Tu cuenta de vendedor está siendo revisada por nuestro equipo. Recibirás una notificación por correo electrónico una vez que tu cuenta sea aprobada."}),e.jsxs("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:["Estado: ",d.vendedor_estado]})]})})})}):se?e.jsx("div",{className:"container py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"loading-spinner w-8 h-8"})})}):e.jsxs(Ne,{title:"Panel de Vendedor",subtitle:"Gestiona tus productos y ventas",children:[f&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-100 text-blue-600",children:e.jsx(r,{category:"Catálogo y producto",name:"BxsPackage",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Productos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.totalProductos})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-100 text-green-600",children:e.jsx(r,{category:"Catálogo y producto",name:"LucideTags",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Activos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.productosActivos})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-100 text-purple-600",children:e.jsx(r,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Pedidos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.totalPedidos})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-indigo-100 text-indigo-600",children:e.jsx(r,{category:"Carrito y checkout",name:"VaadinWallet",className:"w-6 h-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Ventas del Mes"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",f.ventasDelMes]})]})]})})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>P("products"),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${j==="products"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(r,{category:"Catálogo y producto",name:"BxsPackage",className:"w-4 h-4"}),"Mis Productos"]}),e.jsxs("button",{onClick:()=>P("orders"),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${j==="orders"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(r,{category:"Pedidos",name:"MaterialSymbolsOrdersOutlineRounded",className:"w-4 h-4"}),"Pedidos"]}),e.jsxs("button",{onClick:()=>P("add-product"),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${j==="add-product"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(r,{category:"Vendedor",name:"LucideCircleFadingPlus",className:"w-4 h-4"}),"Agregar Producto"]}),e.jsxs("button",{onClick:()=>P("config"),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${j==="config"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(r,{category:"Usuario",name:"RivetIconsSettings",className:"w-4 h-4"}),"Configuración"]})]})})}),j==="products"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:C.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes productos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Comienza agregando tu primer producto."}),e.jsx("button",{onClick:()=>p("add-product"),className:"btn btn-primary",children:"Agregar Producto"})]}):C.map(a=>e.jsxs("div",{className:"card card-hover",children:[a.imagen_url&&e.jsx("div",{className:"h-48 bg-gray-200",children:e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.nombre}),e.jsx("span",{className:`badge ${a.estado==="activo"?"badge-success":"badge-secondary"}`,children:a.estado})]}),e.jsxs("p",{className:"text-xl font-bold text-primary-600 mb-2",children:["$",a.precio]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Stock: ",a.stock," unidades"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>ne(a.id,a.estado),className:`btn-sm flex items-center gap-1 ${a.estado==="activo"?"btn-secondary":"btn-accent"}`,children:a.estado==="activo"?e.jsxs(e.Fragment,{children:[e.jsx(r,{category:"Estados y Feedback",name:"IconParkOutlineSuccess",className:"w-3 h-3"}),"Desactivar"]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{category:"Estados y Feedback",name:"IconParkSolidSuccess",className:"w-3 h-3"}),"Activar"]})}),e.jsxs("button",{className:"btn btn-outline btn-sm flex items-center gap-1",onClick:()=>xe(a),children:[e.jsx(r,{category:"Vendedor",name:"FaSolidEdit",className:"w-3 h-3"}),"Editar"]}),e.jsxs("button",{className:"btn btn-outline btn-sm flex items-center gap-1",onClick:()=>le(a.id,!0),children:[e.jsx(r,{category:"Vendedor",name:"LineMdTrash",className:"w-3 h-3"}),"Archivar"]})]})]})]},a.id))}),j==="orders"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Pedidos Recientes"})}),e.jsx("div",{className:"card-body",children:b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No tienes pedidos aún"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-500",children:"Pedido"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-500",children:"Cliente"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-500",children:"Total"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-500",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-500",children:"Fecha"})]})}),e.jsx("tbody",{children:b.map(a=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-3 px-4 text-sm font-mono",children:["#",a.id.slice(0,8)]}),e.jsx("td",{className:"py-3 px-4 text-sm",children:a.comprador_email}),e.jsxs("td",{className:"py-3 px-4 text-sm font-medium",children:["$",a.total]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`badge ${a.estado==="entregado"?"badge-success":a.estado==="enviado"?"badge-primary":a.estado==="procesando"?"badge-warning":"badge-secondary"}`,children:a.estado})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:new Date(a.created_at).toLocaleDateString()})]},a.id))})]})})})]}),e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Ítems pendientes de envío"})}),e.jsx("div",{className:"card-body",children:L.filter(a=>!a.enviado).length===0?e.jsx("p",{className:"text-gray-500",children:"No tienes ítems pendientes"}):e.jsx("div",{className:"space-y-2",children:L.filter(a=>!a.enviado).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[a.producto_nombre," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["x",a.cantidad]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Pedido #",a.order_id.slice(0,8)]})]}),e.jsxs("button",{className:"btn btn-outline btn-sm flex items-center gap-1",onClick:()=>pe(a.id),children:[e.jsx(r,{category:"Pedidos",name:"HugeiconsDeliveredSent",className:"w-3 h-3"}),"Marcar enviado"]})]},a.id))})})]})]}),j==="add-product"&&e.jsxs("div",{className:"card max-w-2xl",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:n.id?"Editar Producto":"Agregar Nuevo Producto"})}),e.jsxs("div",{className:"card-body",children:[B&&e.jsx("div",{className:"mb-4 rounded-lg bg-red-50 text-red-700 px-3 py-2 text-sm",children:B}),e.jsxs("form",{className:"space-y-6",onSubmit:ue,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nombre del producto"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Ej: Collar artesanal chocoano",value:n.nombre,onChange:a=>v(s=>({...s,nombre:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Descripción"}),e.jsx("textarea",{className:"form-textarea",placeholder:"Describe tu producto...",value:n.descripcion,onChange:a=>v(s=>({...s,descripcion:a.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Precio"}),e.jsx("input",{type:"number",className:"form-input",placeholder:"0.00",value:n.precio,onChange:a=>v(s=>({...s,precio:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Stock"}),e.jsx("input",{type:"number",className:"form-input",placeholder:"0",value:n.stock,onChange:a=>v(s=>({...s,stock:a.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Categoría"}),e.jsxs("select",{className:"form-select",value:n.categoria_id,onChange:a=>v(s=>({...s,categoria_id:a.target.value})),children:[e.jsx("option",{value:"",children:"Seleccionar categoría"}),te.map(a=>e.jsx("option",{value:a.id,children:a.nombre},a.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Imagen del producto"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("svg",{className:"w-8 h-8 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>v(s=>({...s,imagen_file:a.target.files?.[0]||null}))}),n.imagen_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:n.imagen_url,alt:"preview",className:"w-full max-h-40 object-cover rounded"})})]})]}),n.id&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Historia y detalles para conectar con el comprador"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Historia (breve relato)"}),e.jsx("textarea",{className:"form-textarea",placeholder:"¿Qué inspira esta pieza? ¿Quién la hizo? ¿Qué la hace única?",value:x.historia||"",onChange:a=>N(s=>({...s,historia:a.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Materiales (separados por coma)"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Iraca, Madera, Tagua",value:x.materiales||"",onChange:a=>N(s=>({...s,materiales:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Técnica (separadas por coma)"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Tejido, Tallado, Teñido natural",value:x.tecnica||"",onChange:a=>N(s=>({...s,tecnica:a.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Origen / Comunidad"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Istmina, Medio San Juan, Comunidad Emberá...",value:x.origen||"",onChange:a=>N(s=>({...s,origen:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cuidados"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Evitar humedad, limpiar con paño seco...",value:x.cuidados||"",onChange:a=>N(s=>({...s,cuidados:a.target.value}))})]})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",className:"btn btn-primary flex items-center gap-2",disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(r,{category:"Estados y Feedback",name:"HugeiconsReload",className:"w-4 h-4 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{category:"Vendedor",name:"LucideCircleFadingPlus",className:"w-4 h-4"}),"Guardar Producto"]})}),e.jsxs("button",{type:"button",className:"btn btn-outline flex items-center gap-2",onClick:()=>{ee(),p("products")},children:[e.jsx(r,{category:"Estados y Feedback",name:"BxErrorCircle",className:"w-4 h-4"}),"Cancelar"]})]})]})]})]}),j==="config"&&e.jsxs("div",{className:"card max-w-2xl",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Configuración"})}),e.jsxs("div",{className:"card-body space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Perfil del vendedor"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"form-label",children:"Biografía"}),e.jsx("textarea",{className:"form-textarea",value:z,onChange:a=>q(a.target.value),placeholder:"Cuenta tu historia, técnicas, materiales y territorio..."}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Logo / Imagen"}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>{const s=a.target.files?.[0];s&&de(s)},disabled:oe}),D.logoUrl&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:D.logoUrl,alt:"logo",className:"w-24 h-24 object-cover rounded"})})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Preferencias"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Estado por defecto al crear producto"}),e.jsxs("select",{className:"form-select",value:Q,onChange:a=>W(a.target.value),children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:a=>G(a.target.checked)}),"Ocultar productos sin stock"]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Notificaciones"}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:a=>K(a.target.checked)}),"Correo cuando ingrese un pedido nuevo"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:X,onChange:a=>Y(a.target.checked)}),"Correo cuando un ítem se marque enviado"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{className:"btn btn-primary flex items-center gap-2",onClick:ie,children:[e.jsx(r,{category:"Estados y Feedback",name:"IconParkSolidSuccess",className:"w-4 h-4"}),"Guardar cambios"]}),e.jsxs("button",{className:"btn btn-danger ml-auto flex items-center gap-2",onClick:async()=>{if(confirm("¿Eliminar tu cuenta? Esta acción es irreversible."))try{const s=(await i.auth.getSession()).data.session?.access_token,t="https://jdmexfawmetmfabpwlfs.supabase.co";if(t&&s){const o=new URL(t).host.split(".")[0],l=await fetch(`https://${o}.functions.supabase.co/self-account`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}}),m=await l.json();if(!l.ok)throw new Error(m?.error||"No se pudo eliminar");window.toast?.success("Cuenta eliminada",{action:"delete"}),await i.auth.signOut(),window.location.href="/"}}catch(a){window.toast?.error(a?.message||"No se pudo eliminar la cuenta",{action:"delete"})}},children:[e.jsx(r,{category:"Estados y Feedback",name:"BxErrorCircle",className:"w-4 h-4"}),"Eliminar mi cuenta"]})]})]})]})]})};export{Ue as default};
