{"collection":{"info":{"_postman_id":"6fdc9403-3498-4864-b2b7-04ebdbe0976b","name":"Tesoros Chocó API - Flujo Vendedor","description":"# API Tesoros Chocó - Flujo Completo para Vendedor\n\n## 🏗️ Arquitectura\n```\nReact Frontend ↔ Express Backend ↔ Supabase (PostgreSQL + Auth)\n```\n\n## 🔑 Variables Principales\n- `backend_base_url`: http://localhost:4000\n- `supabase_rest_url`: https://jdmexfawmetmfabpwlfs.supabase.co\n- `vendor_email`: quintojessy2222@gmail.com\n- `vendor_password`: Rulexi700.\n- `demo_categoria_id`: a7114981-678c-412e-8648-017f02548872\n\n## ⚡ Orden de Ejecución\n1. Health Check\n2. Auth Supabase (con credenciales de vendedor)\n3. Crear Producto\n4. Actualizar Producto\n5. Marcar Item como Enviado\n\n## ⚠️ Prerequisitos\n- Backend ejecutándose en puerto 4000\n- Vendedor debe estar aprobado en el sistema\n- Clave de Supabase actualizada en el environment\n\n## 📝 Notas Importantes\n- Esta colección requiere que el vendedor esté aprobado en el sistema\n- Las variables dinámicas se establecen automáticamente durante la ejecución\n- Para ejecutar toda la colección, usar el script `run-vendedor-collection.cjs`\n- ⚠️ **Importante**: Esta colección usa variables del environment. Asegúrate de tener configurado el environment \"Tesoros Chocó - Desarrollo\" con los valores correctos.\n- ⚠️ **Importante**: El vendedor debe estar previamente aprobado en el sistema para poder crear productos.\n- ⚠️ **Importante**: La solicitud \"Marcar Item como Enviado\" requiere un `order_item_id` válido que debe establecerse manualmente en el environment.\n\n## 📋 Variables de Colección\n- `vendor_auth_token`: Token JWT de autenticación (se establece automáticamente)\n- `vendor_user_id`: ID del usuario vendedor (se establece automáticamente)\n- `product_id`: ID del producto creado (se establece automáticamente)\n- `order_item_id`: ID del ítem de pedido (debe establecerse manualmente para la prueba de envío)\n\n## 🛠️ Solución de Problemas\n- Si recibes errores 401, verifica que las credenciales del vendedor sean correctas\n- Si recibes errores 404, asegúrate de ejecutar las solicitudes en orden para que las variables se establezcan correctamente\n- Si recibes errores 400, verifica que el vendedor esté aprobado en el sistema","schema":"https://schema.getpostman.com/json/collection/v2.1.0/collection.json","updatedAt":"2025-09-07T22:26:38.000Z","createdAt":"2025-09-07T19:21:04.000Z","lastUpdatedBy":"13226867","uid":"13226867-6fdc9403-3498-4864-b2b7-04ebdbe0976b"},"item":[{"name":"🔍 Health Check","item":[{"name":"GET /health","event":[{"listen":"test","script":{"exec":["pm.test('Status 200', () => pm.response.code === 200);","pm.test('Service OK', () => {","  const j = pm.response.json();","  pm.expect(j.ok).to.be.true;","  pm.expect(j.service).to.equal('backend-demo');","});","console.log('✅ Backend health check passed');"],"type":"text/javascript"}}],"id":"a25a4931-b3a9-4942-8e9b-080f5244621f","request":{"method":"GET","header":[],"url":{"raw":"{{backend_base_url}}/health","host":["{{backend_base_url}}"],"path":["health"]}},"response":[],"uid":"13226867-a25a4931-b3a9-4942-8e9b-080f5244621f"}],"id":"33951a26-9edd-4dc0-9cc2-9d0710e66a5d","description":"Verificar estado del backend Express","uid":"13226867-33951a26-9edd-4dc0-9cc2-9d0710e66a5d"},{"name":"🔐 Auth Vendedor","item":[{"name":"POST Supabase Auth - Vendedor","event":[{"listen":"test","script":{"exec":["if (pm.response.code === 200) {","  const j = pm.response.json();","  pm.test('Auth successful', () => !!j.access_token);","  pm.collectionVariables.set('vendor_auth_token', j.access_token || '');","  pm.collectionVariables.set('vendor_user_id', j.user?.id || '');","  console.log('✅ Authenticated with Supabase as vendor');","} else {","  pm.test('Auth failed', () => false);","  console.log('❌ Auth error:', pm.response.text());","}"],"type":"text/javascript"}}],"id":"56ab2334-49be-4b33-bd20-7712aaec1954","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"apikey","value":"{{supabase_anon_key}}"}],"body":{"mode":"raw","raw":"{\"email\":\"{{vendor_email}}\",\"password\":\"{{vendor_password}}\"}"},"url":{"raw":"{{supabase_rest_url}}/auth/v1/token?grant_type=password","host":["{{supabase_rest_url}}"],"path":["auth","v1","token"],"query":[{"key":"grant_type","value":"password"}]}},"response":[],"uid":"13226867-56ab2334-49be-4b33-bd20-7712aaec1954"},{"name":"POST Backend Post-Signup - Vendedor","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('vendor_user_id')) {","  pm.test('Skip - no vendor_user_id', () => true);","  return;","}","pm.test('Status 200', () => pm.response.code === 200);","console.log('✅ Vendor profile synced');"],"type":"text/javascript"}}],"id":"e4d6d673-0845-467c-846f-e714602d5251","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\"user_id\":\"{{vendor_user_id}}\",\"email\":\"{{vendor_email}}\",\"role\":\"vendedor\"}"},"url":{"raw":"{{backend_base_url}}/auth/post-signup","host":["{{backend_base_url}}"],"path":["auth","post-signup"]}},"response":[],"uid":"13226867-e4d6d673-0845-467c-846f-e714602d5251"}],"id":"65ec9697-f5f1-4af3-ad7e-839cfb30e232","description":"Autenticación directa con Supabase (simula frontend) con credenciales de vendedor","uid":"13226867-65ec9697-f5f1-4af3-ad7e-839cfb30e232"},{"name":"📦 Gestión de Productos","item":[{"name":"POST /productos - Crear Producto","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('vendor_auth_token')) {","  pm.test('Skip - no auth token', () => true);","  return;","}","if (pm.response.code === 201) {","  const j = pm.response.json();","  pm.collectionVariables.set('product_id', j.id || '');","  pm.test('Product created', () => !!j.id);","  console.log('✅ Product created:', j.id);","} else {","  pm.test('Product creation failed', () => false);","  console.log('❌ Product error:', pm.response.text());","}"],"type":"text/javascript"}}],"id":"63510c44-f242-454b-ac05-1d27504c00c3","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{vendor_auth_token}}"}],"body":{"mode":"raw","raw":"{\"nombre\":\"Producto de prueba - Postman\",\"descripcion\":\"Producto creado desde Postman para pruebas\",\"precio\":150000,\"stock\":5,\"categoria_id\":\"{{demo_categoria_id}}\"}"},"url":{"raw":"{{backend_base_url}}/productos","host":["{{backend_base_url}}"],"path":["productos"]}},"response":[],"uid":"13226867-63510c44-f242-454b-ac05-1d27504c00c3"},{"name":"PUT /productos/:id - Actualizar Producto","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('vendor_auth_token')) {","  pm.test('Skip - no auth token', () => true);","  return;","}","if (!pm.collectionVariables.get('product_id')) {","  pm.test('Skip - no product_id', () => true);","  return;","}","pm.test('Status 200', () => pm.response.code === 200);","console.log('✅ Product updated');"],"type":"text/javascript"}}],"id":"272bdc80-f350-47db-80ae-10f62b04b38a","request":{"method":"PUT","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{vendor_auth_token}}"}],"body":{"mode":"raw","raw":"{\"nombre\":\"Producto de prueba - Actualizado\",\"descripcion\":\"Producto actualizado desde Postman para pruebas\",\"precio\":175000,\"stock\":3}"},"url":{"raw":"{{backend_base_url}}/productos/{{product_id}}","host":["{{backend_base_url}}"],"path":["productos","{{product_id}}"]}},"response":[],"uid":"13226867-272bdc80-f350-47db-80ae-10f62b04b38a"}],"id":"a7ec34c8-a445-4b17-b9e6-2903783f4f1a","description":"Gestión de productos por parte del vendedor","uid":"13226867-a7ec34c8-a445-4b17-b9e6-2903783f4f1a"},{"name":"🚚 Gestión de Envíos","item":[{"name":"POST /order-items/:id/shipped - Marcar Item como Enviado","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('vendor_auth_token')) {","  pm.test('Skip - no auth token', () => true);","  return;","}","if (!pm.collectionVariables.get('order_item_id')) {","  pm.test('Skip - no order_item_id', () => true);","  return;","}","pm.test('Status 200', () => pm.response.code === 200);","console.log('✅ Order item marked as shipped');"],"type":"text/javascript"}}],"id":"2aeb28d2-9283-427d-b563-f7350a58cf97","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{vendor_auth_token}}"}],"body":{"mode":"raw","raw":"{}"},"url":{"raw":"{{backend_base_url}}/order-items/{{order_item_id}}/shipped","host":["{{backend_base_url}}"],"path":["order-items","{{order_item_id}}","shipped"]}},"response":[],"uid":"13226867-2aeb28d2-9283-427d-b563-f7350a58cf97"}],"id":"7c59570a-3b59-4a16-8688-74178cf9d154","description":"Marcar items de pedido como enviados (requiere un order_item_id válido)","uid":"13226867-7c59570a-3b59-4a16-8688-74178cf9d154"}],"event":[{"listen":"prerequest","script":{"id":"f73abc7a-81b1-4854-b687-6dbf7ecbd5f2","type":"text/javascript","packages":{},"exec":[""]}},{"listen":"test","script":{"id":"717dc455-016b-4d4b-bae3-a2810b76b77b","type":"text/javascript","packages":{},"exec":[""]}}],"variable":[{"key":"backend_base_url","value":"{{backend_base_url}}"},{"key":"supabase_rest_url","value":"{{supabase_rest_url}}"},{"key":"supabase_anon_key","value":"{{supabase_anon_key}}"},{"key":"vendor_email","value":"{{vendor_email}}"},{"key":"vendor_password","value":"{{vendor_password}}"},{"key":"demo_categoria_id","value":"{{demo_categoria_id}}"},{"key":"vendor_auth_token","value":""},{"key":"vendor_user_id","value":""},{"key":"product_id","value":""},{"key":"order_item_id","value":""}]}}
