{"collection":{"info":{"_postman_id":"a106feaa-6ef9-40b0-9fd0-55301d84dbc0","name":"Tesoros Chocó API - Flujo Comprador","description":"# API Tesoros Chocó - Flujo de Compras para Comprador\n\n## 🏗️ Arquitectura\n```\nReact Frontend ↔ Express Backend ↔ Supabase (PostgreSQL + Auth)\n```\n\n## 🔑 Variables Principales\n- `backend_base_url`: http://localhost:4000\n- `supabase_rest_url`: https://jdmexfawmetmfabpwlfs.supabase.co\n- `buyer_email`: marianareyesgonzalez4@gmail.com\n- `buyer_password`: Rulexi700.\n- `demo_producto_id`: 3a4c4839-3820-409c-a27f-4de3ae954cba\n\n## ⚡ Orden de Ejecución\n1. Health Check\n2. Auth Supabase (con credenciales de comprador)\n3. Crear Pedido\n4. Simular Pago\n5. Cancelar Pedido\n\n## ⚠️ Prerequisitos\n- Backend ejecutándose en puerto 4000\n- Clave de Supabase actualizada en el environment\n\n## 📝 Notas Importantes\n- Esta colección requiere que el producto de prueba tenga stock disponible\n- Las variables dinámicas se establecen automáticamente durante la ejecución\n- El producto de prueba debe existir en la base de datos\n- ⚠️ **Importante**: Esta colección usa variables del environment. Asegúrate de tener configurado el environment \"Tesoros Chocó - Comprador\" con los valores correctos.\n- ⚠️ **Importante**: El producto especificado en `demo_producto_id` debe existir y tener stock disponible para poder crear el pedido.\n\n## 📋 Variables de Colección\n- `buyer_auth_token`: Token JWT de autenticación (se establece automáticamente)\n- `buyer_user_id`: ID del usuario comprador (se establece automáticamente)\n- `order_id`: ID del pedido creado (se establece automáticamente)\n\n## 🛠️ Solución de Problemas\n- Si recibes errores 401, verifica que las credenciales del comprador sean correctas\n- Si recibes errores 404, asegúrate de que el producto con el ID especificado exista\n- Si recibes errores 400, verifica que el producto tenga stock disponible","schema":"https://schema.getpostman.com/json/collection/v2.1.0/collection.json","updatedAt":"2025-09-07T22:27:26.000Z","createdAt":"2025-09-07T19:00:35.000Z","lastUpdatedBy":"13226867","uid":"13226867-a106feaa-6ef9-40b0-9fd0-55301d84dbc0"},"item":[{"name":"🔍 Health Check","item":[{"name":"GET /health","event":[{"listen":"test","script":{"exec":["pm.test('Status 200', () => pm.response.code === 200);","pm.test('Service OK', () => {","  const j = pm.response.json();","  pm.expect(j.ok).to.be.true;","  pm.expect(j.service).to.equal('backend-demo');","});","console.log('✅ Backend health check passed');"],"type":"text/javascript"}}],"id":"d951948d-90e2-4288-a35f-0fa2781721ff","request":{"method":"GET","header":[],"url":{"raw":"{{backend_base_url}}/health","host":["{{backend_base_url}}"],"path":["health"]}},"response":[],"uid":"13226867-d951948d-90e2-4288-a35f-0fa2781721ff"}],"id":"783f08c2-5d40-4353-801f-b0b498f553bc","description":"Verificar estado del backend Express","uid":"13226867-783f08c2-5d40-4353-801f-b0b498f553bc"},{"name":"🔐 Auth Comprador","item":[{"name":"POST Supabase Auth - Comprador","event":[{"listen":"test","script":{"exec":["if (pm.response.code === 200) {","  const j = pm.response.json();","  pm.test('Auth successful', () => !!j.access_token);","  pm.collectionVariables.set('buyer_auth_token', j.access_token || '');","  pm.collectionVariables.set('buyer_user_id', j.user?.id || '');","  console.log('✅ Authenticated with Supabase as buyer');","} else {","  pm.test('Auth failed', () => false);","  console.log('❌ Auth error:', pm.response.text());","}"],"type":"text/javascript"}}],"id":"70db16a4-7357-48cf-bd84-a1358a4cc54a","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"apikey","value":"{{supabase_anon_key}}"}],"body":{"mode":"raw","raw":"{\"email\":\"{{buyer_email}}\",\"password\":\"{{buyer_password}}\"}"},"url":{"raw":"{{supabase_rest_url}}/auth/v1/token?grant_type=password","host":["{{supabase_rest_url}}"],"path":["auth","v1","token"],"query":[{"key":"grant_type","value":"password"}]}},"response":[],"uid":"13226867-70db16a4-7357-48cf-bd84-a1358a4cc54a"},{"name":"POST Backend Post-Signup - Comprador","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('buyer_user_id')) {","  pm.test('Skip - no buyer_user_id', () => true);","  return;","}","pm.test('Status 200', () => pm.response.code === 200);","console.log('✅ Buyer profile synced');"],"type":"text/javascript"}}],"id":"8c3911b7-4bc1-41af-aa67-442a1787ad20","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\"user_id\":\"{{buyer_user_id}}\",\"email\":\"{{buyer_email}}\",\"role\":\"comprador\"}"},"url":{"raw":"{{backend_base_url}}/auth/post-signup","host":["{{backend_base_url}}"],"path":["auth","post-signup"]}},"response":[],"uid":"13226867-8c3911b7-4bc1-41af-aa67-442a1787ad20"}],"id":"a48c433c-8214-4cff-afe3-8c44fdab7853","description":"Autenticación directa con Supabase (simula frontend) con credenciales de comprador","uid":"13226867-a48c433c-8214-4cff-afe3-8c44fdab7853"},{"name":"🛒 Pedidos Comprador","item":[{"name":"POST /rpc/crear_pedido","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('buyer_auth_token')) {","  pm.test('Skip - no auth token', () => true);","  return;","}","if (pm.response.code === 200) {","  const j = pm.response.json();","  pm.collectionVariables.set('order_id', j.order_id || '');","  pm.test('Order created', () => !!j.order_id);","  console.log('✅ Order created:', j.order_id);","} else {","  pm.test('Order failed', () => false);","  console.log('❌ Order error:', pm.response.text());","}"],"type":"text/javascript"}}],"id":"959774c4-fb9c-434f-b882-1125f574d50d","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{buyer_auth_token}}"}],"body":{"mode":"raw","raw":"{\"items\":[{\"producto_id\":\"{{demo_producto_id}}\",\"cantidad\":1}]}"},"url":{"raw":"{{backend_base_url}}/rpc/crear_pedido","host":["{{backend_base_url}}"],"path":["rpc","crear_pedido"]}},"response":[],"uid":"13226867-959774c4-fb9c-434f-b882-1125f574d50d"}],"id":"9e39215e-88c3-471d-8b1e-f0ff623b357e","description":"Crear pedido con autenticación JWT de comprador","uid":"13226867-9e39215e-88c3-471d-8b1e-f0ff623b357e"},{"name":"💳 Pagos Comprador","item":[{"name":"POST /payments/simulate","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('order_id')) {","  pm.test('Skip - no order_id', () => true);","  return;","}","if (pm.response.code === 200) {","  const j = pm.response.json();","  pm.test('Payment simulated', () => j.ok === true);","  console.log('✅ Payment simulated successfully');","} else {","  pm.test('Payment failed', () => false);","  console.log('❌ Payment error:', pm.response.text());","}"],"type":"text/javascript"}}],"id":"b925a4cf-98f8-4cdb-a3bf-1f42ce78cbf8","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\"order_id\":\"{{order_id}}\",\"approved\":true}"},"url":{"raw":"{{backend_base_url}}/payments/simulate","host":["{{backend_base_url}}"],"path":["payments","simulate"]}},"response":[],"uid":"13226867-b925a4cf-98f8-4cdb-a3bf-1f42ce78cbf8"}],"id":"b92f8b46-691f-4707-b99c-a756cea31d64","description":"Simular procesamiento de pagos","uid":"13226867-b92f8b46-691f-4707-b99c-a756cea31d64"},{"name":"❌ Cancelar Pedido","item":[{"name":"POST /orders/:id/cancel - Cancelar Pedido","event":[{"listen":"test","script":{"exec":["if (!pm.collectionVariables.get('buyer_auth_token')) {","  pm.test('Skip - no auth token', () => true);","  return;","}","if (!pm.collectionVariables.get('order_id')) {","  pm.test('Skip - no order_id', () => true);","  return;","}","pm.test('Status 200', () => pm.response.code === 200);","console.log('✅ Order cancelled');"],"type":"text/javascript"}}],"id":"90194c8b-5cf9-49ea-be86-d261ceef7048","request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{buyer_auth_token}}"}],"body":{"mode":"raw","raw":"{}"},"url":{"raw":"{{backend_base_url}}/orders/{{order_id}}/cancel","host":["{{backend_base_url}}"],"path":["orders","{{order_id}}","cancel"]}},"response":[],"uid":"13226867-90194c8b-5cf9-49ea-be86-d261ceef7048"}],"id":"13226867-13226867-13226867-cancel-order-folder","description":"Cancelar pedido creado"}],"variable":[{"key":"backend_base_url","value":"http://localhost:4000"},{"key":"supabase_rest_url","value":"https://jdmexfawmetmfabpwlfs.supabase.co"},{"key":"supabase_anon_key","value":"{{supabase_anon_key}}"},{"key":"buyer_email","value":"marianareyesgonzalez4@gmail.com"},{"key":"buyer_password","value":"Rulexi700."},{"key":"demo_producto_id","value":"3a4c4839-3820-409c-a27f-4de3ae954cba"},{"key":"buyer_auth_token","value":""},{"key":"buyer_user_id","value":""},{"key":"order_id","value":""}]}}
